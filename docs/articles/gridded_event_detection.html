<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Detecting Events in Gridded Data • heatwaveR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Detecting Events in Gridded Data">
<meta property="og:description" content="This vignette demonstrates how to deetect marine heatwaves (MHWs) in dataframes of gridded data in which each pixel is a separate time series.">
<meta property="og:image" content="https://robwschlegel.github.io/heatwaveR/index.html/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-118123016-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118123016-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">heatwaveR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.2.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/detection_and_visualisation.html">Basic Detection and Visualisation of Events</a>
    </li>
    <li>
      <a href="../articles/exceedance.html">Calculating and Visualising Exceedances</a>
    </li>
    <li>
      <a href="../articles/event_categories.html">Calculating and Visualising Event Categories</a>
    </li>
    <li>
      <a href="../articles/OISST_preparation.html">Downloading and Preparing OISST Data</a>
    </li>
    <li>
      <a href="../articles/gridded_event_detection.html">Detecting Events in Gridded Data</a>
    </li>
    <li>
      <a href="../articles/complex_clims.html">Alternative Thresholds</a>
    </li>
  </ul>
</li>
<li>
  <a href="../CITATIONS.html">Citations</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/robwschlegel/heatwaveR">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Detecting Events in Gridded Data</h1>
                        <h4 class="author">Robert W Schlegel and AJ Smit</h4>
            
            <h4 class="date">2020-06-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/robwschlegel/heatwaveR/blob/master/vignettes/gridded_event_detection.Rmd"><code>vignettes/gridded_event_detection.Rmd</code></a></small>
      <div class="hidden name"><code>gridded_event_detection.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>Because of human-induced climate change, we anticipate that extreme events will occur more frequently and that they will become greater in intensity. Here we investigate this hypothesis by using gridded SST data, which is the only way that we can assess if this trend is unfolding across large ocean regions. Using the gridded <a href="http://dx.doi.org/10.1175/2007JCLI1824.1">0.25 degree Reynolds OISST</a>, we will detect marine heatwaves (MHWs) around South Africa by applying the <code><a href="../reference/detect_event.html">detect_event()</a></code> function pixel-by-pixel to the data we downloaded in <a href="https://robwschlegel.github.io/heatwaveR/articles/OISST_preparation.html">the previous vignette</a>. After detecting the events, we will fit a generalised linear model (GLM) to each pixel to calculate rates of change in some MHW metrics, and then plot the estimated trends.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>) <span class="co"># For basic data manipulation</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>) <span class="co"># For visualising data</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">heatwaveR</span>) <span class="co"># For detecting MHWs</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidync</span>) <span class="co"># For easily dealing with NetCDF data</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">doParallel</span>) <span class="co"># For parallel processing</span></pre></body></html></div>
</div>
<div id="gridded-data" class="section level2">
<h2 class="hasAnchor">
<a href="#gridded-data" class="anchor"></a>Gridded data</h2>
<p>In the previous vignette we saw how to <a href="https://robwschlegel.github.io/heatwaveR/articles/OISST_preparation.html">download and prepare OISST data</a>. In this vignette we will use the data we downloaded for our example on how to detect MHWs in gridded data. Note that because we are going to be detecting MHWs we will want at least 30 years of data. The code in the previous vignette can be used to download these data with only minor alterations. It would be preferable to use an ERDDAP server to download only the data necessary, but as of this writing (June 6th, 2020) NOAA OISST v2.1 data are not available on any ERDDAP servers. So we will need to make a plan in order to deal with these large global data files while only using a laptop.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Load one file</span>
<span class="no">load_region</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">file_name</span>){
      <span class="no">OISST_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/tidync/reference/tidync.html">tidync</a></span>(<span class="no">file_name</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://docs.ropensci.org/tidync/reference/hyper_filter.html">hyper_filter</a></span>(<span class="kw">lon</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span>(<span class="no">lon</span>, <span class="fl">15</span>, <span class="fl">21</span>),
                     <span class="kw">lat</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span>(<span class="no">lat</span>, -<span class="fl">40</span>, -<span class="fl">35</span>)) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://docs.ropensci.org/tidync/reference/hyper_tibble.html">hyper_tibble</a></span>() <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">lon</span>, <span class="no">lat</span>, <span class="no">time</span>, <span class="no">sst</span>) <span class="kw">%&gt;%</span>
        <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">t</span> <span class="kw">=</span> <span class="no">time</span>, <span class="kw">temp</span> <span class="kw">=</span> <span class="no">sst</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">t</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="no">t</span>, <span class="kw">origin</span> <span class="kw">=</span> <span class="st">"1978-01-01"</span>))
      <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">OISST_dat</span>)
}

<span class="co"># Locate the files that will be loaded</span>
<span class="no">OISST_files</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>(<span class="st">"~/data/OISST"</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="no">T</span>)

<span class="co"># NB: One should never use ALL available cores, save at least 1 for other essential tasks</span>
<span class="co"># The computer I'm writing this vignette on has 8 cores, so I use 6 here</span>
<span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span>(<span class="kw">cores</span> <span class="kw">=</span> <span class="fl">7</span>)

<span class="co"># Load the data in parallel</span>
<span class="co"># Note that it will take quite a while to load 30 years of data</span>
<span class="co"># because each day is saved as a separate file</span>
<span class="co"># On 6 cores it took more than 30 minutes</span>
<span class="co"># Run this as only a few years at a time in case of errors</span>
<span class="co"># It may be necessary to reduce the number of files being loaded at once depending on one's RAM</span>
<span class="co"># It's also a safer choice to save these files as we go</span>
<span class="no">OISST1</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">1</span>:<span class="fl">1000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST1</span>, <span class="st">"~/data/OISST1_agulhas_region.Rda"</span>)
<span class="no">OISST2</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">1001</span>:<span class="fl">2000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST2</span>, <span class="st">"~/data/OISST2_agulhas_region.Rda"</span>)
<span class="no">OISST3</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">2001</span>:<span class="fl">3000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST3</span>, <span class="st">"~/data/OISST3_agulhas_region.Rda"</span>)
<span class="no">OISST4</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">3001</span>:<span class="fl">4000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST4</span>, <span class="st">"~/data/OISST4_agulhas_region.Rda"</span>)
<span class="no">OISST5</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">4001</span>:<span class="fl">5000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST5</span>, <span class="st">"~/data/OISST5_agulhas_region.Rda"</span>)
<span class="no">OISST6</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">5001</span>:<span class="fl">6000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST6</span>, <span class="st">"~/data/OISST6_agulhas_region.Rda"</span>)
<span class="no">OISST7</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">6001</span>:<span class="fl">7000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST7</span>, <span class="st">"~/data/OISST7_agulhas_region.Rda"</span>)
<span class="no">OISST8</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">7001</span>:<span class="fl">8000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST8</span>, <span class="st">"~/data/OISST8_agulhas_region.Rda"</span>)
<span class="no">OISST9</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">8001</span>:<span class="fl">9000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST9</span>, <span class="st">"~/data/OISST9_agulhas_region.Rda"</span>)
<span class="no">OISST10</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">9001</span>:<span class="fl">10000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST10</span>, <span class="st">"~/data/OISST10_agulhas_region.Rda"</span>)
<span class="no">OISST11</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">10001</span>:<span class="fl">11000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST11</span>, <span class="st">"~/data/OISST11_agulhas_region.Rda"</span>)
<span class="no">OISST12</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">11001</span>:<span class="fl">12000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST12</span>, <span class="st">"~/data/OISST12_agulhas_region.Rda"</span>)
<span class="no">OISST13</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">12001</span>:<span class="fl">13000</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST13</span>, <span class="st">"~/data/OISST13_agulhas_region.Rda"</span>)
<span class="no">OISST14</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>[<span class="fl">13001</span>:<span class="fl">13879</span>], <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">load_region</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST14</span>, <span class="st">"~/data/OISST14_agulhas_region.Rda"</span>)

<span class="co"># Then combine them</span>
<span class="no">OISST</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">OISST1</span>, <span class="no">OISST2</span>, <span class="no">OISST3</span>, <span class="no">OISST4</span>, <span class="no">OISST5</span>, <span class="no">OISST6</span>, <span class="no">OISST7</span>,
               <span class="no">OISST8</span>, <span class="no">OISST9</span>, <span class="no">OISST10</span>, <span class="no">OISST11</span>, <span class="no">OISST12</span>, <span class="no">OISST13</span>, <span class="no">OISST14</span>)

<span class="co"># Save our new file for faster loading if we need it again</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span>(<span class="no">OISST</span>, <span class="st">"~/data/OISST_agulhas_region.Rda"</span>)

<span class="co"># Remove the smaller files and clean up</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="no">OISST1</span>, <span class="no">OISST2</span>, <span class="no">OISST3</span>, <span class="no">OISST4</span>, <span class="no">OISST5</span>, <span class="no">OISST6</span>, <span class="no">OISST7</span>,
   <span class="no">OISST8</span>, <span class="no">OISST9</span>, <span class="no">OISST10</span>, <span class="no">OISST11</span>, <span class="no">OISST12</span>, <span class="no">OISST13</span>, <span class="no">OISST14</span>)
<span class="fu"><a href="https://rdrr.io/r/base/gc.html">gc</a></span>()</pre></body></html></div>
<p>This is obviously not great if it takes us over 30 minutes to load the data and dozens of lines of repeated code. Ideally one would be able to access only the necessary data via an ERDDAP server but this is not currently possible. When NOAA hosts the v2.1 OISST data on an ERDDAP server I’ll upload a new vignette that shows how to perform the same task as above in a much shorter and easier way.</p>
</div>
<div id="event-detection" class="section level2">
<h2 class="hasAnchor">
<a href="#event-detection" class="anchor"></a>Event detection</h2>
<p>When we want to make the same calculation across multiple groups of data within one dataframe we have many good options available to us. The first is to make use of the <code>map()</code> suite of functions found in the <strong><code>purrr</code></strong> package, and now implemented in <strong><code>dplyr</code></strong>. This is a very fast <strong><code>tidyverse</code></strong> friendly approach to splitting up tasks. Another good option is to go back in time a bit and use the <code>ddply()</code> function from the <strong><code>plyr</code></strong> package. This is arguably a better approach as it allows us to very easily use multiple cores to detect the MHWs. The problem with this approach is that one must <em>never</em> load the <strong><code>plyr</code></strong> library directly as it has some fundamental inconsistencies with <strong><code>dplyr</code></strong> and other packages in the <strong><code>tidyverse</code></strong>. In a previous version of this vignette I provided multiple approaches for calculating MHWs but I’ve found over time that the functionality that is being added to <strong><code>dplyr</code></strong> and it’s siblings is consistently slower and more convoluted than the original <strong><code>plyr</code></strong> approach. For that reason we will use only that method here.</p>
<p>It is a little clumsy to use multiple functions at once with <code>ddply()</code> so we will combine the calculations we want to make into one wrapper function first.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">event_only</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">df</span>){
  <span class="co"># First calculate the climatologies</span>
  <span class="no">clim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ts2clm.html">ts2clm</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">df</span>, <span class="kw">climatologyPeriod</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1982-01-01"</span>, <span class="st">"2011-01-01"</span>))
  <span class="co"># Then the events</span>
  <span class="no">event</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/detect_event.html">detect_event</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">clim</span>)
  <span class="co"># Return only the event metric dataframe of results</span>
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">event</span>$<span class="no">event</span>)
}</pre></body></html></div>
<p>With that convenience function loaded into our environment we may now use <code>ddply()</code> in just one line of code to detect all of the MHWs in our study area.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
<span class="no">MHW_result</span> <span class="kw">&lt;-</span> <span class="no">plyr</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ddply.html">ddply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST</span>, <span class="kw">.variables</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">event_only</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
) <span class="co"># 30 seconds</span></pre></body></html></div>
<p>The <strong><code>plyr</code></strong> method took 30 seconds using seven cores. This method is not seven times faster than if we used a single core because when using multiple cores there is a certain amount of loss in efficiency due to the computer needing to remember which results are meant to go where so that it can stitch everything back together again for you. This takes very little memory, but over large jobs it can start to become problematic. Occasionally ‘slippage’ can occur as well where an entire task can be forgotten. This is very rare but does happen. This is partly what makes <strong><code>dplyr</code></strong> a viable option as it does not have this problem. To further maximise efficiency I would recommend writing out this full workflow in a stand-alone script and then running it using <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> directly from an R terminal.</p>
</div>
<div id="trend-detection" class="section level2">
<h2 class="hasAnchor">
<a href="#trend-detection" class="anchor"></a>Trend detection</h2>
<p>With our MHW detected we will now look at how to fit some GLMs to the results in order to determine long-term trends in MHW occurrence.</p>
<p>Up first we see how to calculate the number of events that occurred per pixel.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># summarise the number of unique longitude, latitude and year combination:</span>
<span class="no">event_freq</span> <span class="kw">&lt;-</span> <span class="no">MHW_result</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">year</span> <span class="kw">=</span> <span class="kw pkg">lubridate</span><span class="kw ns">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(<span class="no">date_start</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">lon</span>, <span class="no">lat</span>, <span class="no">year</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span>())
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">event_freq</span>)

<span class="co"># create complete grid for merging with:</span>
<span class="no">sst_grid</span> <span class="kw">&lt;-</span> <span class="no">OISST</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">lon</span>, <span class="no">lat</span>, <span class="no">t</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">t</span> <span class="kw">=</span> <span class="kw pkg">lubridate</span><span class="kw ns">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(<span class="no">t</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">year</span> <span class="kw">=</span> <span class="no">t</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>()

<span class="co"># and merge:</span>
<span class="no">OISST_n</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">sst_grid</span>, <span class="no">event_freq</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>, <span class="st">"year"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">n</span>), <span class="fl">0</span>, <span class="no">n</span>))</pre></body></html></div>
<p>Then we specify the particulars of the GLM we are going to use.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">lin_fun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">ev</span>) {
  <span class="no">mod1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(<span class="no">n</span> ~ <span class="no">year</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span>(<span class="kw">link</span> <span class="kw">=</span> <span class="st">"log"</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">ev</span>)
  <span class="co"># extract slope coefficient and its p-value</span>
  <span class="no">tr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">slope</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mod1</span>)$<span class="no">coefficients</span>[<span class="fl">2</span>,<span class="fl">1</span>],
                   <span class="kw">p</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mod1</span>)$<span class="no">coefficients</span>[<span class="fl">2</span>,<span class="fl">4</span>])
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">tr</span>)
}</pre></body></html></div>
<p>Lastly we make the calculations.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">OISST_nTrend</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ddply.html">ddply</a></span>(<span class="no">OISST_n</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="no">lin_fun</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="no">OISST_nTrend</span>$<span class="no">pval</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="no">OISST_nTrend</span>$<span class="no">p</span>, <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">1</span>))
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">OISST_nTrend</span>)</pre></body></html></div>
</div>
<div id="visualising-the-results" class="section level2">
<h2 class="hasAnchor">
<a href="#visualising-the-results" class="anchor"></a>Visualising the results</h2>
<p>Let’s finish this vignette by visualising the long-term trends in the annual occurrence of MHWs per pixel in the chosen study area. First we will grab the base global map from the <strong><code>maps</code></strong> package.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># The base map</span>
<span class="no">map_base</span> <span class="kw">&lt;-</span> <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span>(<span class="kw pkg">maps</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">FALSE</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">lon</span> <span class="kw">=</span> <span class="no">long</span>)</pre></body></html></div>
<p>Then we will create two maps that we will stick together using <strong><code>ggpubr</code></strong>. The first map will show the slope of the count of events detected per year over time as shades of red, and the second map will show the significance (<em>p</em>-value) of these trends in shades of grey.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">map_slope</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">OISST_nTrend</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">lon</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="fl">NA</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">xmin</span> <span class="kw">=</span> <span class="no">lon</span> - <span class="fl">0.1</span>, <span class="kw">xmax</span> <span class="kw">=</span> <span class="no">lon</span> + <span class="fl">0.1</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">lat</span> - <span class="fl">0.1</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">lat</span> + <span class="fl">0.1</span>,
           <span class="kw">colour</span> <span class="kw">=</span> <span class="no">pval</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">slope</span>), <span class="kw">interpolate</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.9</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"count/year (slope)"</span>, <span class="kw">high</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">mid</span> <span class="kw">=</span> <span class="st">"white"</span>,
                       <span class="kw">low</span> <span class="kw">=</span> <span class="st">"darkblue"</span>, <span class="kw">midpoint</span> <span class="kw">=</span> <span class="fl">0</span>,
                       <span class="kw">guide</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html">guide_colourbar</a></span>(<span class="kw">direction</span> <span class="kw">=</span> <span class="st">"horizontal"</span>,
                                               <span class="kw">title.position</span> <span class="kw">=</span> <span class="st">"top"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"(0,0.001]"</span>, <span class="st">"(0.001,0.01]"</span>, <span class="st">"(0.01,0.05]"</span>, <span class="st">"(0.05,1]"</span>),
                      <span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"firebrick1"</span>, <span class="st">"firebrick2"</span>, <span class="st">"firebrick3"</span>, <span class="st">"white"</span>),
                      <span class="kw">name</span> <span class="kw">=</span> <span class="st">"p-value"</span>, <span class="kw">guide</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">map_base</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">group</span> <span class="kw">=</span> <span class="no">group</span>),
               <span class="kw">colour</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"grey80"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span>(<span class="kw">ratio</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">13.0</span>, <span class="fl">23.0</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">33</span>, -<span class="fl">42</span>), <span class="kw">expand</span> <span class="kw">=</span> <span class="fl">TRUE</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">""</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)

<span class="no">map_p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">OISST_nTrend</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">lon</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">pval</span>), <span class="kw">interpolate</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"(0,0.001]"</span>, <span class="st">"(0.001,0.01]"</span>, <span class="st">"(0.01,0.05]"</span>,
                               <span class="st">"(0.05,0.1]"</span>, <span class="st">"(0.1,0.5]"</span>, <span class="st">"(0.5,1]"</span>),
                    <span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"grey20"</span>, <span class="st">"grey40"</span>,
                               <span class="st">"grey80"</span>, <span class="st">"grey90"</span>, <span class="st">"white"</span>),
                    <span class="kw">name</span> <span class="kw">=</span> <span class="st">"p-value"</span>,
                    <span class="kw">guide</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span>(<span class="kw">direction</span> <span class="kw">=</span> <span class="st">"horizontal"</span>,
                                               <span class="kw">title.position</span> <span class="kw">=</span> <span class="st">"top"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">map_base</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">group</span> <span class="kw">=</span> <span class="no">group</span>),
               <span class="kw">colour</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"grey80"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span>(<span class="kw">ratio</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">13.0</span>, <span class="fl">23.0</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">33</span>, -<span class="fl">42</span>), <span class="kw">expand</span> <span class="kw">=</span> <span class="fl">TRUE</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">""</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)

<span class="no">map_both</span> <span class="kw">&lt;-</span> <span class="kw pkg">ggpubr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggpubr/man/ggarrange.html">ggarrange</a></span>(<span class="no">map_slope</span>, <span class="no">map_p</span>, <span class="kw">align</span> <span class="kw">=</span> <span class="st">"hv"</span>)
<span class="no">map_both</span></pre></body></html></div>
<p>From the figure above we may see that the entire study area shows significant (<em>p</em>&lt;= 0.05) increases in the count of MHWs per year. This is generally the case for the entire globe. Not shown here is the significant increase in the intensity of MHWs as well.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Robert W. Schlegel, Albertus J. Smit.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '2edc7627dae0471f3d765c3355bebbf3',
    indexName: 'heatwaver',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
