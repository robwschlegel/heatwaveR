<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alternative Thresholds • heatwaveR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Alternative Thresholds">
<meta property="og:description" content="This vignette walks the user through multiple different options for creating and applying thresholds outside of the default settings.">
<meta property="og:image" content="https://robwschlegel.github.io/heatwaveR/index.html/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-118123016-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118123016-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">heatwaveR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.2.9007</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/detection_and_visualisation.html">Basic Detection and Visualisation of Events</a>
    </li>
    <li>
      <a href="../articles/event_categories.html">Calculating and Visualising Event Categories</a>
    </li>
    <li>
      <a href="../articles/exceedance.html">Calculating and Visualising Exceedances</a>
    </li>
    <li>
      <a href="../articles/complex_clims.html">Alternative Thresholds</a>
    </li>
    <li>
      <a href="../articles/MHW_metric_trends.html">Trend and Breakpoint Analyses</a>
    </li>
    <li>
      <a href="../articles/OISST_preparation.html">Downloading and Preparing OISST Data</a>
    </li>
    <li>
      <a href="../articles/gridded_event_detection.html">Detecting Events in Gridded Data</a>
    </li>
    <li>
      <a href="../articles/Download_SST_v2.html">Download, Prepare, and Analyse Data: Alternative</a>
    </li>
    <li>
      <a href="../articles/MHW_to_nc.html">Saving MHW Results to NetCDF</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://193.50.85.71:3838/demoMHW/" class="external-link">Tutorial</a>
</li>
<li>
  <a href="../CITATIONS.html">Citations</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/robwschlegel/heatwaveR" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Alternative Thresholds</h1>
                        <h4 data-toc-skip class="author">Robert W
Schlegel</h4>
            
            <h4 data-toc-skip class="date">2024-01-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/robwschlegel/heatwaveR/blob/HEAD/vignettes/complex_clims.Rmd" class="external-link"><code>vignettes/complex_clims.Rmd</code></a></small>
      <div class="hidden name"><code>complex_clims.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <strong><code>heatwaveR</code></strong> package was designed to
include many different methods for the creation of climatologies and
thresholds for detecting extremes events (e.g. heatwaves and
cold-spells) in time series data. To this end we made a very large
change in the event detection pipeline when we moved from the
<strong><code>RmarineHeatWaves</code></strong> package to
<strong><code>heatwaveR</code></strong>. This change may primarily be
seen with the inclusion of the <code><a href="../reference/ts2clm.html">ts2clm()</a></code> function and the
removal of the climatology performed in
<code>RmarineHeatWaves::detect()</code> in favour of
<code><a href="../reference/detect_event.html">detect_event()</a></code>, which does not calculate climatologies. In
this way we have allowed for the introduction of a multitude of more
complex climatology calculation and event detection/filtering methods.
It is our overarching goal to provide one package that allows climate
scientists to calculate these events in both the atmosphere and oceans.
But rather than talking about it, let’s walk through some case studies
on how this package can be used for diverse applications.</p>
</div>
<div class="section level2">
<h2 id="double-thresholds">Double thresholds<a class="anchor" aria-label="anchor" href="#double-thresholds"></a>
</h2>
<p>Brought to our attention by Mr. Haouari from the Hydrometeorological
Institute of Training and Research (IHFR) in Algeria was the concept of
using a flat (e.g. 19<span class="math inline">\(^\circ\)</span>C)
<code>tMin</code> bottom boundary when calculating events from
<code>tMax</code> with the standard 90th percentile upper threshold. As
the authors of the <strong><code>heatwaveR</code></strong> package are
admittedly marine oriented, we tend to work with daily time series that
have only one mean value per day (e.g. <code>tMean</code>,
<code>temp</code>, <code>sst</code>). This is why there are not
arguments in the <strong><code>heatwaveR</code></strong> suite of
functions that call on <code>tMin</code> and <code>tMax</code>
explicitly, but that does not mean that one cannot do so. Below we will
work through the steps one would take to calculate (atmospheric)
heatwaves, as per their definition in <span class="citation">Perkins and
Alexander (2013)</span> (but excluding the calculation of EHF), and with
the additional step proposed by Mr. Haouari.</p>
<p>The following sub-sections will show the step-by-step process one may
use to calculate atmospheric heatwaves using a 90th percentile threshold
created from the <code>tMax</code> time series for a location, but will
only use the days when the corresponding <code>tMin</code> also exceeds
a pre-determined flat bottom boundary on the same days to quantify the
heatwave metrics. We will finish by visualising the results with the
built-in <strong><code>heatwaveR</code></strong> graphing functions of
<code><a href="../reference/event_line.html">event_line()</a></code> and <code>lolli_plot</code> as well as a
bubble plot. The data we will use for these examples will be a 45 year
time series of daily atmospheric <code>tMin</code> and <code>tMax</code>
temperatures over Algiers, Algeria contributed by Mr. Haouari.</p>
<div class="section level3">
<h3 id="data-prep">Data prep<a class="anchor" aria-label="anchor" href="#data-prep"></a>
</h3>
<p>The first step with any analysis in R should be the loading of the
packages to be used.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://robwschlegel.github.io/heatwaveR/index.html">heatwaveR</a></span><span class="op">)</span></span></code></pre></div>
<p>With our libraries loaded, we will now go about explicitly calling
the <code>Algiers</code> data into our environment. These data are
automatically loaded for us when we load the <code>heatwaveR</code>
library, but we perform this step here just for clarity. Anyone
following along should feel free to use whatever data they would like.
As long as the data have a date (<code>t</code>), <code>tMin</code>, and
<code>tMax</code> column this code will function as designed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Algiers</span> <span class="op">&lt;-</span> <span class="va">Algiers</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculating-thresholds">Calculating thresholds<a class="anchor" aria-label="anchor" href="#calculating-thresholds"></a>
</h3>
<p>With our libraries and data loaded, we will now calculate the two
thresholds we need to correctly detect the heatwaves and accurately
quantify their metrics. The first is the 90th percentile threshold based
on the <code>tMax</code> time series. The second is the flat exceedance
of 19<span class="math inline">\(^\circ\)</span>C based on the
<code>tMin</code> data. We use 19<span class="math inline">\(^\circ\)</span>C as the bottom threshold as this
is roughly the mean <code>tMin</code> for summer temperatures.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The tMax threshold</span></span>
<span><span class="co"># The current WMO standard climatology period is 1981-01-01 to 2010-12-31 and should be used when possible</span></span>
<span><span class="co"># We rather use 1961-01-01 to 1990-01-01 as this is the oldest 30 year period available in the data</span></span>
<span><span class="va">tMax_clim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts2clm.html">ts2clm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Algiers</span>, y <span class="op">=</span> <span class="va">tMax</span>, climatologyPeriod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1961-01-01"</span>, <span class="st">"1990-12-31"</span><span class="op">)</span>, pctile <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The tMin exceedance</span></span>
<span><span class="co"># Note the use here of 'minDuration = 3' and 'maxGap = 1' as the default atmospheric arguments</span></span>
<span><span class="co"># The default marine arguments are 'minDuration = 5' and 'maxGap = 2'</span></span>
<span><span class="va">tMin_exc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exceedance.html">exceedance</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Algiers</span>, y <span class="op">=</span> <span class="va">tMin</span>, threshold <span class="op">=</span> <span class="fl">19</span>, minDuration <span class="op">=</span> <span class="fl">3</span>, maxGap <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">threshold</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculating-events">Calculating events<a class="anchor" aria-label="anchor" href="#calculating-events"></a>
</h3>
<p>Now that the two thresholds have been calculated we use the
<code><a href="../reference/detect_event.html">detect_event()</a></code> function as usual, but provide the second
threshold to the argument <code>threshClim2</code> that would normally
lay dormant.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note that because we calculated our 90th percentile threshold on a column named 'tMax' </span></span>
<span><span class="co"># and not the default column name 'temp', we must specify this below with 'y = tMax'</span></span>
<span><span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect_event.html">detect_event</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tMax_clim</span>, y <span class="op">=</span> <span class="va">tMax</span>, <span class="co"># The 90th percentile threshold</span></span>
<span>                       threshClim2 <span class="op">=</span> <span class="va">tMin_exc</span><span class="op">$</span><span class="va">exceedance</span><span class="op">)</span> <span class="co"># The flat exceedance threshold</span></span></code></pre></div>
<p>Please note that even though the use of the second threshold does
allow for the resultant event metrics to differ, the values themselves
are still being calculated against the seasonal climatology and daily
temperatures for the time series given to the 90th percentile threshold
calculation (in this case <code>tMax</code>) and so using a second
threshold (in this case <code>tMin</code>) won’t generally have much of
an effect on the event metrics. Rather it mostly screens out smaller or
larger events depending on how one chooses to set the threshold. In the
case when an exceedance threshold is chosen for a temperature that would
typically only occur in summer (e.g. 19<span class="math inline">\(^\circ\)</span>C, as used here), one is also
effectively screening events by season. There are many use cases where
this would be desirable. For example, if one is only interested in
events that would occur during a season in which night time heat stress
becomes an issue for the young and elderly.</p>
</div>
<div class="section level3">
<h3 id="creating-visuals">Creating visuals<a class="anchor" aria-label="anchor" href="#creating-visuals"></a>
</h3>
<p>Even though we have used two thresholds to calculate our events, the
results are output the same as though only one threshold (default) were
used. This means that we may use the visualisation functions that come
with <strong><code>heatwaveR</code></strong> without any extra fuss.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The code to create a bubble plot for the heatwave results</span></span>
<span><span class="va">bubble_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">events</span><span class="op">$</span><span class="va">event</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_peak</span>, y <span class="op">=</span> <span class="va">intensity_max</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">intensity_cumulative</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span>, fill <span class="op">=</span> <span class="st">"salmon"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Maximum Intensity [°C] "</span>, size <span class="op">=</span> <span class="st">"Cumulative Intensity [°C x days]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>                        guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"top"</span>, direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.12</span><span class="op">)</span>,</span>
<span>        legend.box.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Don't forget to set 'event_line(y = tMax)'</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/event_line.html">event_line</a></span><span class="op">(</span><span class="va">events</span>, y <span class="op">=</span> <span class="va">tMax</span>, metric <span class="op">=</span> <span class="va">intensity_max</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="../reference/event_line.html">event_line</a></span><span class="op">(</span><span class="va">events</span>, y <span class="op">=</span> <span class="va">tMax</span>, metric <span class="op">=</span> <span class="va">intensity_max</span>, category <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="../reference/lolli_plot.html">lolli_plot</a></span><span class="op">(</span><span class="va">events</span><span class="op">)</span>,</span>
<span>          <span class="va">bubble_plot</span>,</span>
<span>          ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span>, align <span class="op">=</span> <span class="st">"hv"</span><span class="op">)</span></span></code></pre></div>
<p><img src="complex_clims_files/figure-html/visuals-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="alternative-second-thresholds">Alternative second thresholds<a class="anchor" aria-label="anchor" href="#alternative-second-thresholds"></a>
</h3>
<p>Using a percentile based second threshold is not much different than
using a static second threshold. Rather than using
<code><a href="../reference/exceedance.html">exceedance()</a></code> to get our second threshold we can use
<code>ts2clm</code> nested within <code><a href="../reference/detect_event.html">detect_event()</a></code>. It must
also be pointed out that in addition to using multiple thresholds, we
can adjust the minimum duration (<code>minDuration</code>) and maximum
gap (<code>maxGap</code>) arguments for our multiple thresholds, too.
This allows us to provide different ‘flavours’ of criteria for our
events. For example, let’s say we are interested in night-time events
(<code>tMin</code>) when the temperatures remain above the 80th
percentile threshold (<code>pctile = 80</code>) for 10 or more days
(<code>minDuration = 10</code>) without dipping below that threshold for
more than 2 consecutive days (<code>maxGap = 2</code>). But on top of
that, we are also only interested in those parts of the event when the
daytime temperatures exceed the 90th percentile threshold
(<code>pctile = 90</code>) for 3 or more days
(<code>minDuration = 3</code>) non-stop (<code>maxGap = 0</code>).</p>
<p>Below we will look at how to detect/calculate events that meet these
rather specific criteria. We will also calculate events with just the
first threshold and compare the results visually. It must be noted here
that whichever criteria is the most strict, in this case
<code>minDuration = 3</code> and <code>maxGap = 0</code>, will be the
predominant filter through which the event metrics are quantified.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note that because we are not using the standard column name 'temp' we must</span></span>
<span><span class="co"># specify the chosen column name twice, once for ts2clm() and again for detect_event()</span></span>
<span></span>
<span><span class="co"># First threshold based on tMin</span></span>
<span><span class="va">thresh_tMin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts2clm.html">ts2clm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Algiers</span>, y <span class="op">=</span> <span class="va">tMin</span>, pctile <span class="op">=</span> <span class="fl">80</span>, </span>
<span>                      climatologyPeriod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1961-01-01"</span>, <span class="st">"1990-12-31"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Second threshold based on tMax</span></span>
<span><span class="co"># Be careful here that you put the arguments within the correct brackets</span></span>
<span><span class="va">thresh_tMax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect_event.html">detect_event</a></span><span class="op">(</span><span class="fu"><a href="../reference/ts2clm.html">ts2clm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Algiers</span>, y <span class="op">=</span> <span class="va">tMax</span>, pctile <span class="op">=</span> <span class="fl">90</span>, </span>
<span>                                   climatologyPeriod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1961-01-01"</span>, <span class="st">"1990-12-31"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            <span class="co"># These arguments are passed to detect_event(), not ts2clm()</span></span>
<span>                            minDuration <span class="op">=</span> <span class="fl">3</span>, maxGap <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="va">tMax</span>, protoEvents <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Detect/calculate events using the two precalculated thresholds</span></span>
<span><span class="co"># Because detect_event() is not able to deduce which arguments we used above,</span></span>
<span><span class="co"># we must again tell it explicitly here</span></span>
<span><span class="va">events_two_thresh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect_event.html">detect_event</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">thresh_tMin</span>, y <span class="op">=</span> <span class="va">tMin</span>, minDuration <span class="op">=</span> <span class="fl">10</span>, maxGap <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                  threshClim2 <span class="op">=</span> <span class="va">thresh_tMax</span><span class="op">$</span><span class="va">event</span>, minDuration2 <span class="op">=</span> <span class="fl">3</span>, maxGap2 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or to simply use one threshold</span></span>
<span><span class="va">events_one_thresh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect_event.html">detect_event</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">thresh_tMin</span>, y <span class="op">=</span> <span class="va">tMin</span>, minDuration <span class="op">=</span> <span class="fl">10</span>, maxGap <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Here are the differences in lolliplot format:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/lolli_plot.html">lolli_plot</a></span><span class="op">(</span><span class="va">events_one_thresh</span><span class="op">)</span>, <span class="fu"><a href="../reference/lolli_plot.html">lolli_plot</a></span><span class="op">(</span><span class="va">events_two_thresh</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"One threshold"</span>, <span class="st">"Two thresholds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="complex_clims_files/figure-html/alt-two-thresh-lollis-1.png" width="768"></p>
<p>Here is a brief display of the top few events from each method:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">events_one_thresh</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   event_no index_start index_peak index_end duration date_start  date_peak</span></span>
<span><span class="co">## 1        1        6135       6137      6144       10 1977-10-18 1977-10-20</span></span>
<span><span class="co">## 2        2       10844      10845     10856       13 1990-09-09 1990-09-10</span></span>
<span><span class="co">## 3        3       11191      11200     11201       11 1991-08-22 1991-08-31</span></span>
<span><span class="co">## 4        4       13292      13300     13301       10 1997-05-23 1997-05-31</span></span>
<span><span class="co">## 5        5       15534      15542     15546       13 2003-07-13 2003-07-21</span></span>
<span><span class="co">##     date_end intensity_mean intensity_max intensity_var intensity_cumulative</span></span>
<span><span class="co">## 1 1977-10-27         6.3138        9.4382        2.2112              63.1381</span></span>
<span><span class="co">## 2 1990-09-21         4.8424        7.1201        1.1790              62.9507</span></span>
<span><span class="co">## 3 1991-09-01         4.2121        6.9957        1.3819              46.3328</span></span>
<span><span class="co">## 4 1997-06-01         5.1003        6.9670        1.4467              51.0026</span></span>
<span><span class="co">## 5 2003-07-25         4.9539        7.8255        1.5317              64.4012</span></span>
<span><span class="co">##   intensity_mean_relThresh intensity_max_relThresh intensity_var_relThresh</span></span>
<span><span class="co">## 1                   3.7265                  6.8697                  2.2268</span></span>
<span><span class="co">## 2                   2.1077                  4.3639                  1.1767</span></span>
<span><span class="co">## 3                   1.5352                  4.2877                  1.3602</span></span>
<span><span class="co">## 4                   2.3915                  4.3123                  1.4514</span></span>
<span><span class="co">## 5                   2.4188                  5.3032                  1.5337</span></span>
<span><span class="co">##   intensity_cumulative_relThresh intensity_mean_abs intensity_max_abs</span></span>
<span><span class="co">## 1                        37.2652            19.1700              22.6</span></span>
<span><span class="co">## 2                        27.4000            21.9538              24.6</span></span>
<span><span class="co">## 3                        16.8871            22.6091              25.1</span></span>
<span><span class="co">## 4                        23.9148            18.4400              20.7</span></span>
<span><span class="co">## 5                        31.4441            23.6154              26.6</span></span>
<span><span class="co">##   intensity_var_abs intensity_cumulative_abs rate_onset rate_decline</span></span>
<span><span class="co">## 1            2.4454                    191.7     2.7282       0.8901</span></span>
<span><span class="co">## 2            1.2474                    285.4     2.9576       0.3342</span></span>
<span><span class="co">## 3            1.2169                    248.7     0.5665       2.5287</span></span>
<span><span class="co">## 4            1.5284                    184.4     0.6922       3.4156</span></span>
<span><span class="co">## 5            1.5737                    307.0     0.6559       1.2658</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">events_two_thresh</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   event_no index_start index_peak index_end duration date_start  date_peak</span></span>
<span><span class="co">## 1        1        6135       6137      6137        3 1977-10-18 1977-10-20</span></span>
<span><span class="co">## 2        2       10851      10851     10856        6 1990-09-16 1990-09-16</span></span>
<span><span class="co">## 3        3       11191      11200     11201       11 1991-08-22 1991-08-31</span></span>
<span><span class="co">## 4        4       13292      13294     13294        3 1997-05-23 1997-05-25</span></span>
<span><span class="co">## 5        5       15540      15542     15545        6 2003-07-19 2003-07-21</span></span>
<span><span class="co">##     date_end intensity_mean intensity_max intensity_var intensity_cumulative</span></span>
<span><span class="co">## 1 1977-10-20         7.8121        9.4382        1.6787              23.4362</span></span>
<span><span class="co">## 2 1990-09-21         4.6254        6.2445        1.1706              27.7521</span></span>
<span><span class="co">## 3 1991-09-01         4.2121        6.9957        1.3819              46.3328</span></span>
<span><span class="co">## 4 1997-05-25         4.5271        5.5434        1.0897              13.5814</span></span>
<span><span class="co">## 5 2003-07-24         5.5217        7.8255        1.6801              33.1301</span></span>
<span><span class="co">##   intensity_mean_relThresh intensity_max_relThresh intensity_var_relThresh</span></span>
<span><span class="co">## 1                   5.2521                  6.8697                  1.6710</span></span>
<span><span class="co">## 2                   1.9070                  3.5148                  1.1701</span></span>
<span><span class="co">## 3                   1.5352                  4.2877                  1.3602</span></span>
<span><span class="co">## 4                   1.7688                  2.7948                  1.0998</span></span>
<span><span class="co">## 5                   3.0012                  5.3032                  1.6827</span></span>
<span><span class="co">##   intensity_cumulative_relThresh intensity_mean_abs intensity_max_abs</span></span>
<span><span class="co">## 1                        15.7562            21.1000              22.6</span></span>
<span><span class="co">## 2                        11.4419            21.4667              23.3</span></span>
<span><span class="co">## 3                        16.8871            22.6091              25.1</span></span>
<span><span class="co">## 4                         5.3064            17.4667              18.6</span></span>
<span><span class="co">## 5                        18.0071            24.3167              26.6</span></span>
<span><span class="co">##   intensity_var_abs intensity_cumulative_abs rate_onset rate_decline</span></span>
<span><span class="co">## 1            1.5524                     63.3     2.7282       1.9769</span></span>
<span><span class="co">## 2            1.1776                    128.8     0.9760       0.5396</span></span>
<span><span class="co">## 3            1.2169                    248.7     0.5665       2.5287</span></span>
<span><span class="co">## 4            1.2055                     52.4     1.7839       0.1172</span></span>
<span><span class="co">## 5            1.7034                    145.9     0.7293       1.0585</span></span></code></pre>
<p>If we look at these results we see that the use of two thresholds did
not detected fewer events than the use of one threshold. This is because
even though the second threshold was much more ‘difficult’ for the time
series to surpass than the first, the heatwaves in the time series are
so pronounced that they emerge regardless. This method allows for a lot
of flexibility, but users should also be cautious that they understand
what exactly they are asking their machines to do. In the case above, it
may be that we would actually prefer to calculate our event metrics
based entirely on the first threshold, but filter out the events that
didn’t meet our second threshold criteria. We will see how to do this in
the following section.</p>
</div>
</div>
<div class="section level2">
<h2 id="filtering-with-a-second-threshold">Filtering with a second threshold<a class="anchor" aria-label="anchor" href="#filtering-with-a-second-threshold"></a>
</h2>
<p>The methodology outlined below for the detection and filtering of
events with two thresholds is somewhat cumbersome. A potential issue
with this technique is that the multiple filters do not affect the
calculation of the event metrics
(e.g. <code>intensity_cumulative</code>), as only the primary threshold
given to <code><a href="../reference/detect_event.html">detect_event()</a></code> is used when calculating event
metrics. This may however be the desired case if one is still interested
in knowing the cumulative intensity above the given percentile
threshold, but only wants to filter the full event based on some other
threshold criteria. I can imagine real-world use cases for both
scenarios, which is why this seemingly less sophisticated approach is
detailed below.</p>
<div class="section level3">
<h3 id="filtering-events">Filtering events<a class="anchor" aria-label="anchor" href="#filtering-events"></a>
</h3>
<p>Because we have already calculated our single threshold events
(<code>events_one_thresh</code>) and our second threshold
(<code>thresh_tMax</code>) we may directly begin filtering the results.
Before we do so, let’s pull out the list components of our results into
dataframes for easier use down the line.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pull out each data.frame as their own object for easier use</span></span>
<span><span class="va">events_one_event</span> <span class="op">&lt;-</span> <span class="va">events_one_thresh</span><span class="op">$</span><span class="va">event</span></span>
<span><span class="va">events_one_climatology</span> <span class="op">&lt;-</span> <span class="va">events_one_thresh</span><span class="op">$</span><span class="va">climatology</span></span></code></pre></div>
<p>This is where things may get tricky for some users, and where the
default use of the functions in the
<strong><code>heatwaveR</code></strong> package ends. We are now going
‘off-road’ so to speak. But do not despair! The
<strong><code>tidyverse</code></strong> suite of packages makes data
wrangling like this much more user friendly than it was in the dark days
of Base R coding.</p>
<p>In order to make the filtering of events easier, we will combine the
two different dataframes that we are using as threshold/filtering guides
to chose the events that meet all of our selection criteria.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Join the two threshold dataframes</span></span>
<span><span class="va">two_thresh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">events_one_climatology</span>, <span class="va">thresh_tMax</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"t"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove all days that did not qualify as events in both thresholds</span></span>
<span><span class="va">two_thresh_filtered</span> <span class="op">&lt;-</span> <span class="va">two_thresh</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">event.x</span> <span class="op">==</span> <span class="cn">TRUE</span>,</span>
<span>         <span class="va">event.y</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>With our filtering guide created, we may now apply it to
<code>events_one_thresh</code> to get our filtered results.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Copy data with a new name</span></span>
<span><span class="va">events_one_thresh_filtered</span> <span class="op">&lt;-</span> <span class="va">events_one_thresh</span></span>
<span></span>
<span><span class="co"># Then filter</span></span>
<span><span class="va">events_one_thresh_filtered</span><span class="op">$</span><span class="va">event</span> <span class="op">&lt;-</span> <span class="va">events_one_thresh_filtered</span><span class="op">$</span><span class="va">event</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">event_no</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">two_thresh_filtered</span><span class="op">$</span><span class="va">event_no.x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">events_one_thresh_filtered</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   event_no index_start index_peak index_end duration date_start  date_peak</span></span>
<span><span class="co">## 1        1        6135       6137      6144       10 1977-10-18 1977-10-20</span></span>
<span><span class="co">## 2        2       10844      10845     10856       13 1990-09-09 1990-09-10</span></span>
<span><span class="co">## 3        3       11191      11200     11201       11 1991-08-22 1991-08-31</span></span>
<span><span class="co">## 4        4       13292      13300     13301       10 1997-05-23 1997-05-31</span></span>
<span><span class="co">## 5        5       15534      15542     15546       13 2003-07-13 2003-07-21</span></span>
<span><span class="co">##     date_end intensity_mean intensity_max intensity_var intensity_cumulative</span></span>
<span><span class="co">## 1 1977-10-27         6.3138        9.4382        2.2112              63.1381</span></span>
<span><span class="co">## 2 1990-09-21         4.8424        7.1201        1.1790              62.9507</span></span>
<span><span class="co">## 3 1991-09-01         4.2121        6.9957        1.3819              46.3328</span></span>
<span><span class="co">## 4 1997-06-01         5.1003        6.9670        1.4467              51.0026</span></span>
<span><span class="co">## 5 2003-07-25         4.9539        7.8255        1.5317              64.4012</span></span>
<span><span class="co">##   intensity_mean_relThresh intensity_max_relThresh intensity_var_relThresh</span></span>
<span><span class="co">## 1                   3.7265                  6.8697                  2.2268</span></span>
<span><span class="co">## 2                   2.1077                  4.3639                  1.1767</span></span>
<span><span class="co">## 3                   1.5352                  4.2877                  1.3602</span></span>
<span><span class="co">## 4                   2.3915                  4.3123                  1.4514</span></span>
<span><span class="co">## 5                   2.4188                  5.3032                  1.5337</span></span>
<span><span class="co">##   intensity_cumulative_relThresh intensity_mean_abs intensity_max_abs</span></span>
<span><span class="co">## 1                        37.2652            19.1700              22.6</span></span>
<span><span class="co">## 2                        27.4000            21.9538              24.6</span></span>
<span><span class="co">## 3                        16.8871            22.6091              25.1</span></span>
<span><span class="co">## 4                        23.9148            18.4400              20.7</span></span>
<span><span class="co">## 5                        31.4441            23.6154              26.6</span></span>
<span><span class="co">##   intensity_var_abs intensity_cumulative_abs rate_onset rate_decline</span></span>
<span><span class="co">## 1            2.4454                    191.7     2.7282       0.8901</span></span>
<span><span class="co">## 2            1.2474                    285.4     2.9576       0.3342</span></span>
<span><span class="co">## 3            1.2169                    248.7     0.5665       2.5287</span></span>
<span><span class="co">## 4            1.5284                    184.4     0.6922       3.4156</span></span>
<span><span class="co">## 5            1.5737                    307.0     0.6559       1.2658</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">events_two_thresh</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   event_no index_start index_peak index_end duration date_start  date_peak</span></span>
<span><span class="co">## 1        1        6135       6137      6137        3 1977-10-18 1977-10-20</span></span>
<span><span class="co">## 2        2       10851      10851     10856        6 1990-09-16 1990-09-16</span></span>
<span><span class="co">## 3        3       11191      11200     11201       11 1991-08-22 1991-08-31</span></span>
<span><span class="co">## 4        4       13292      13294     13294        3 1997-05-23 1997-05-25</span></span>
<span><span class="co">## 5        5       15540      15542     15545        6 2003-07-19 2003-07-21</span></span>
<span><span class="co">##     date_end intensity_mean intensity_max intensity_var intensity_cumulative</span></span>
<span><span class="co">## 1 1977-10-20         7.8121        9.4382        1.6787              23.4362</span></span>
<span><span class="co">## 2 1990-09-21         4.6254        6.2445        1.1706              27.7521</span></span>
<span><span class="co">## 3 1991-09-01         4.2121        6.9957        1.3819              46.3328</span></span>
<span><span class="co">## 4 1997-05-25         4.5271        5.5434        1.0897              13.5814</span></span>
<span><span class="co">## 5 2003-07-24         5.5217        7.8255        1.6801              33.1301</span></span>
<span><span class="co">##   intensity_mean_relThresh intensity_max_relThresh intensity_var_relThresh</span></span>
<span><span class="co">## 1                   5.2521                  6.8697                  1.6710</span></span>
<span><span class="co">## 2                   1.9070                  3.5148                  1.1701</span></span>
<span><span class="co">## 3                   1.5352                  4.2877                  1.3602</span></span>
<span><span class="co">## 4                   1.7688                  2.7948                  1.0998</span></span>
<span><span class="co">## 5                   3.0012                  5.3032                  1.6827</span></span>
<span><span class="co">##   intensity_cumulative_relThresh intensity_mean_abs intensity_max_abs</span></span>
<span><span class="co">## 1                        15.7562            21.1000              22.6</span></span>
<span><span class="co">## 2                        11.4419            21.4667              23.3</span></span>
<span><span class="co">## 3                        16.8871            22.6091              25.1</span></span>
<span><span class="co">## 4                         5.3064            17.4667              18.6</span></span>
<span><span class="co">## 5                        18.0071            24.3167              26.6</span></span>
<span><span class="co">##   intensity_var_abs intensity_cumulative_abs rate_onset rate_decline</span></span>
<span><span class="co">## 1            1.5524                     63.3     2.7282       1.9769</span></span>
<span><span class="co">## 2            1.1776                    128.8     0.9760       0.5396</span></span>
<span><span class="co">## 3            1.2169                    248.7     0.5665       2.5287</span></span>
<span><span class="co">## 4            1.2055                     52.4     1.7839       0.1172</span></span>
<span><span class="co">## 5            1.7034                    145.9     0.7293       1.0585</span></span></code></pre>
<p>The event numbers found in <code>events_one_thresh_filtered</code>
are the same as the event numbers found in
<code>events_two_thresh</code> with the important difference that the
event metrics in <code>events_two_thresh</code> were calculated only on
the days that exceeded both thresholds, while the events in
<code>events_one_thresh_filtered</code> have had their metrics
calculated from all of the days that exceeded only the first
threshold.</p>
</div>
<div class="section level3">
<h3 id="visualising-filtered-events">Visualising filtered events<a class="anchor" aria-label="anchor" href="#visualising-filtered-events"></a>
</h3>
<p>To better understand how different the results from these two
different techniques may be we will use lolliplots to visualise
them.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/lolli_plot.html">lolli_plot</a></span><span class="op">(</span><span class="va">events_two_thresh</span>, metric <span class="op">=</span> <span class="va">duration</span><span class="op">)</span>, </span>
<span>          <span class="fu"><a href="../reference/lolli_plot.html">lolli_plot</a></span><span class="op">(</span><span class="va">events_one_thresh_filtered</span>, metric <span class="op">=</span> <span class="va">duration</span><span class="op">)</span>, </span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Double threshold"</span>, <span class="st">"Filter threshold"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: centre">
<img src="complex_clims_files/figure-html/lolliplot-duration-1.png" alt="Difference in duration (days) of events given different applications of thresholds. Note the difference in the y-axes." width="768"><p class="caption">
Difference in duration (days) of events given different applications of
thresholds. Note the difference in the y-axes.
</p>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/lolli_plot.html">lolli_plot</a></span><span class="op">(</span><span class="va">events_two_thresh</span>, metric <span class="op">=</span> <span class="va">intensity_cumulative</span><span class="op">)</span>, </span>
<span>          <span class="fu"><a href="../reference/lolli_plot.html">lolli_plot</a></span><span class="op">(</span><span class="va">events_one_thresh_filtered</span>, metric <span class="op">=</span> <span class="va">intensity_cumulative</span><span class="op">)</span>, </span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Double threshold"</span>, <span class="st">"Filter threshold"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: centre">
<img src="complex_clims_files/figure-html/lolliplot-int-cum-1.png" alt="Difference in cumulative intensity (°C x days) of events given different applications of thresholds. Note the difference in the y-axes." width="768"><p class="caption">
Difference in cumulative intensity (°C x days) of events given different
applications of thresholds. Note the difference in the y-axes.
</p>
</div>
<p>One may of course visualise the outputs from the events calculated
here with <code><a href="../reference/geom_flame.html">geom_flame()</a></code> and <code><a href="../reference/geom_lolli.html">geom_lolli()</a></code> as
well, but this will not differ from the default method of using these
functions as outlined in their help files so we will not go into that
here.</p>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This vignette serves as a guideline for how to implement multiple
methodologies for using two thresholds (<code>tMin</code> and
<code>tMax</code>) with atmospheric data. We also showed in this
vignette a more straight forward approach to using a second threshold
through the built-in arguments in <code><a href="../reference/detect_event.html">detect_event()</a></code>. The use
of a second threshold in this way, whether it be based on a static
threshold or one derived from a percentile, is useful for the
consideration of events that may be more specifically relevant to a
given season or organism.</p>
<p>I hope the techniques shown in this vignette will be useful both
technically and theoretically. The authors of
<strong><code>heatwaveR</code></strong> are very happy to receive any
further input on the development of the package as well as other
potential methods for calculating heatwaves and cold-spells in air or
sea.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Perkins2013" class="csl-entry">
Perkins, Sarah E., and Lisa V. Alexander. 2013. <span>“<span class="nocase">On the measurement of heat waves</span>.”</span>
<em>Journal of Climate</em> 26 (13): 4500–4517.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robert W. Schlegel, Albertus J. Smit.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '2edc7627dae0471f3d765c3355bebbf3',
    indexName: 'heatwaver',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
