<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Downloading and Preparing NOAA OISST Data • heatwaveR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Downloading and Preparing NOAA OISST Data">
<meta property="og:description" content="This vignette demonstrates how to download NOAA OISST data and prepare them for the detection of marine heatwaves.">
<meta property="og:image" content="https://robwschlegel.github.io/heatwaveR/index.html/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-118123016-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118123016-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">heatwaveR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.2.9009</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/detection_and_visualisation.html">Basic Detection and Visualisation of Events</a>
    </li>
    <li>
      <a href="../articles/event_categories.html">Calculating and Visualising Event Categories</a>
    </li>
    <li>
      <a href="../articles/exceedance.html">Calculating and Visualising Exceedances</a>
    </li>
    <li>
      <a href="../articles/complex_clims.html">Alternative Thresholds</a>
    </li>
    <li>
      <a href="../articles/MHW_metric_trends.html">Trend and Breakpoint Analyses</a>
    </li>
    <li>
      <a href="../articles/OISST_preparation.html">Downloading and Preparing OISST Data</a>
    </li>
    <li>
      <a href="../articles/gridded_event_detection.html">Detecting Events in Gridded Data</a>
    </li>
    <li>
      <a href="../articles/Download_SST_v2.html">Download, Prepare, and Analyse Data: Alternative</a>
    </li>
    <li>
      <a href="../articles/MHW_to_nc.html">Saving MHW Results to NetCDF</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://193.50.85.71:3838/demoMHW/" class="external-link">Tutorial</a>
</li>
<li>
  <a href="../CITATIONS.html">Citations</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/robwschlegel/heatwaveR" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Downloading and Preparing NOAA OISST Data</h1>
                        <h4 data-toc-skip class="author">Robert W
Schlegel and AJ Smit</h4>
            
            <h4 data-toc-skip class="date">2024-01-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/robwschlegel/heatwaveR/blob/HEAD/vignettes/OISST_preparation.Rmd" class="external-link"><code>vignettes/OISST_preparation.Rmd</code></a></small>
      <div class="hidden name"><code>OISST_preparation.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In this vignette we will see how to retrieve and prepare Reynolds
optimally interpolated sea surface temperature (OISST) data for
calculating marine heatwaves (MHWs). The OISST product is a global 1/4
degree gridded dataset of Advanced Very High Resolution Radiometer
(AVHRR) derived SSTs at a daily resolution, starting on 1 September
1981. The source of the data is currently the <a href="https://www.ncei.noaa.gov/products/optimum-interpolation-sst" class="external-link">NOAA
NCDC</a>.</p>
<p>Each daily global file, when not compressed, is around 8.3 MB, so
they add up to a large amount of data when a time series of the
recommended 30 year minimum duration for the detection of MHWs is
downloaded. If one were to download all of the data currently available
it would exceed 100 GB of total disk space. It is therefore best
practice to download only a subset of the data that matches one’s study
area. Thanks to the <a href="https://docs.ropensci.org/rerddap/" class="external-link"><strong><code>rerddap</code></strong>
package</a> this is incredibly easy to do in <code>R</code>.</p>
<p>Should one want to download the full global dataset, each daily
global file is available in netCDF format and is roughly 1.6 MB. This
means that one full year of global data will be roughly 600 MB, and the
full dataset roughly 25 GB. This is however when the data are very
compressed. If we were to attempt to load the entire uncompressed
dataset into our memory at once it would take more than 200 GB of RAM.
That is well beyond the scope of any current laptop so in the second
half of this vignette we will see how to download the full OISST dataset
before then seeing how we can load only a subset of the data into the R
environment for use with further analyses.</p>
<p>This vignette may appear very long and complex but it has been
written in an attempt to keep the process of downloading and working
with satellite data as straight-forward and easy to follow as possible.
Before we begin with all of the code etc. please note that for almost
all applications it is only necessary to use the first method outlined
below. For most users the second download method in this vignette can
simply be skipped.</p>
<p><strong>NB:</strong> Please note that most of the functions used in
this vignette do <em>not</em> come from the
<strong><code>heatwaveR</code></strong> package. If one encounters
issues with the following code, it is likely due to an external
function. One may note the package from which a function comes by
looking to the left of <code>::</code> in the code. For example,
<code><a href="https://docs.ropensci.org/rerddap/reference/griddap.html" class="external-link">rerddap::griddap()</a></code> means that the <code><a href="https://docs.ropensci.org/rerddap/reference/griddap.html" class="external-link">griddap()</a></code>
function is maintained by the authors of the
<strong><code>rerddap</code></strong> package and any errors caused by
this function should be directed to them.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>For this vignette we will be accessing the NOAA OISST dataset on this
<a href="https://coastwatch.pfeg.noaa.gov/erddap/griddap/index.html" class="external-link">ERDDAP
server</a> for the subsetted data, while the global data are indexed <a href="https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/" class="external-link">here</a>.
One may download the data on both servers manually by using the ERDDAP
UI or clicking on each indexed file individually. But programming
languages like R are designed to prevent us from needing to experience
that sort of anguish. Below we will load the libraries we need in order
to have R download all of the data that we may need. If any of the lines
of code in the following chunk do not run it means that we will need to
first install that package. Uncomment the line of code that would
install the problem package and run it before trying to load the library
again.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The packages we will need</span></span>
<span><span class="co"># install.packages("dplyr")</span></span>
<span><span class="co"># install.packages("lubridate")</span></span>
<span><span class="co"># install.packages("ggplot2")</span></span>
<span><span class="co"># install.packages("tidync")</span></span>
<span><span class="co"># install.packages("doParallel")</span></span>
<span><span class="co"># install.packages("rerddap")</span></span>
<span><span class="co"># install.packages("plyr") # Note that this library should never be loaded, only installed</span></span>
<span></span>
<span><span class="co"># The packages we will use</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># A staple for modern data management in R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span> <span class="co"># Useful functions for dealing with dates</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># The preferred library for data visualisation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/tidync/" class="external-link">tidync</a></span><span class="op">)</span> <span class="co"># For easily dealing with NetCDF data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rerddap/" class="external-link">rerddap</a></span><span class="op">)</span> <span class="co"># For easily downloading subsets of data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span> <span class="co"># For parallel processing</span></span></code></pre></div>
<p>With our packages loaded we may now begin downloading and preparing
our data for further use. Please use the table of contents on the right
side of the screen to jump between the different download methods as
desired. We will break each different method down into smaller steps in
order to keep this process as clear as possible. Before we begin I need
to stress that this is a very direct and unrestricted method for
accessing these data and I urge responsibility in only downloading as
much data as are necessary. Please do not download the entire dataset
unless you have a specific need for it.</p>
</div>
<div class="section level2">
<h2 id="downloading-subsetted-data">Downloading subsetted data<a class="anchor" aria-label="anchor" href="#downloading-subsetted-data"></a>
</h2>
<div class="section level3">
<h3 id="file-information">File information<a class="anchor" aria-label="anchor" href="#file-information"></a>
</h3>
<p>Before we begin downloading the subsetted data for our study area we
need to make sure that they are currently available on an ERDDAP server.
The location of the NOAA OISST data has changed in the past so it should
not be assumed that the current location will exist in perpetuity.
Finding the server on which these data are located can be a cup game at
times.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The information for the NOAA OISST data</span></span>
<span><span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span>datasetid <span class="op">=</span> <span class="st">"ncdcOisst21Agg_LonPM180"</span>, url <span class="op">=</span> <span class="st">"https://coastwatch.pfeg.noaa.gov/erddap/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note that there is also a version with lon values from 0 yo 360</span></span>
<span><span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span>datasetid <span class="op">=</span> <span class="st">"ncdcOisst21Agg"</span>, url <span class="op">=</span> <span class="st">"https://coastwatch.pfeg.noaa.gov/erddap/"</span><span class="op">)</span></span></code></pre></div>
<p>With our target dataset identified we may now begin the download with
the <code><a href="https://docs.ropensci.org/rerddap/reference/griddap.html" class="external-link">rerddap::griddap()</a></code> function. Note that the ERDDAP
server does not like it when one tries to access more than nine
consecutive years of data in one request, regardless of the spatial
extent being requested. So before we download our data we are going to
make a wrapper function that helps us control the range of times we want
to download. This will reduce the amount of redundant coding we would
otherwise need to do.</p>
</div>
<div class="section level3">
<h3 id="download-function">Download function<a class="anchor" aria-label="anchor" href="#download-function"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This function downloads and prepares data based on user provided start and end dates</span></span>
<span><span class="va">OISST_sub_dl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_df</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">OISST_dat</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/griddap.html" class="external-link">griddap</a></span><span class="op">(</span>datasetx <span class="op">=</span> <span class="st">"ncdcOisst21Agg_LonPM180"</span>,</span>
<span>                                url <span class="op">=</span> <span class="st">"https://coastwatch.pfeg.noaa.gov/erddap/"</span>, </span>
<span>                                time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">time_df</span><span class="op">$</span><span class="va">start</span>, <span class="va">time_df</span><span class="op">$</span><span class="va">end</span><span class="op">)</span>, </span>
<span>                                zlev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                                latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">40</span>, <span class="op">-</span><span class="fl">35</span><span class="op">)</span>,</span>
<span>                                longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">21</span><span class="op">)</span>,</span>
<span>                                fields <span class="op">=</span> <span class="st">"sst"</span><span class="op">)</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">time</span>, <span class="st">"T12:00:00Z"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">time</span>, temp <span class="op">=</span> <span class="va">sst</span>, lon <span class="op">=</span> <span class="va">longitude</span>, lat <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, <span class="va">t</span>, <span class="va">temp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In the wrapper function above we see that we have chosen to download
only the ‘sst’ data out of the several variables (‘fields’) available to
us. We also see that we have chosen the spatial extent of latitude -40
to -35 and longitude 15 to 21. This a small window over some of the
Agulhas Retroflection to the south west of South Africa. A larger area
is not being chosen here simply due to the speed constraints of
downloading the data and detecting the events therein. One may simply
change the longitude and latitude values above as necessary to match the
desired study area. The function will also be re-labelling the ‘time’
column as ‘t’, and the ‘sst’ column as ‘temp’. We do this so that they
match the default column names that are expected for calculating MHWs
and we won’t have to do any extra work later on.</p>
<p>One must note here that depending on the RAM available on one’s
machine, it may not be possible to handle all of the data downloaded at
once if they are very large (e.g. &gt; 5 GB). The discussion on the
limitations of the R language due to its dependence on virtual memory is
beyond the scope of this vignette, but if one limits one’s downloads to
no more than several square pixels at a time that should be fine. Were
one to try to download the whole Indian Ocean, for example, that may
cause issues if being run on a laptop or computer of a similar
power.</p>
</div>
<div class="section level3">
<h3 id="date-range">Date range<a class="anchor" aria-label="anchor" href="#date-range"></a>
</h3>
<p>With our wrapper function written we would now need to run it several
times in order to grab all of the OISST data from
<code>1982-01-01</code> to <code>2019-12-31</code>. Even though each
year of data for the extent used in this vignette is only ~360 KB, the
server does not like it when more than 9 years of consecutive data are
requested. The server will also end a users connection after ~17
individual files have been requested. Because we can’t download all of
the data in one request, and we can’t download the data one year at a
time, we will need to make requests for multiple batches of data. To
accomplish this we will create a dataframe of start and end dates that
will allow us to automate the entire download while meeting the
aforementioned criteria.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Date download range by start and end dates per year</span></span>
<span><span class="va">dl_years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>date_index <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>                       start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1982-01-01"</span>, <span class="st">"1990-01-01"</span>, </span>
<span>                                 <span class="st">"1998-01-01"</span>, <span class="st">"2006-01-01"</span>, <span class="st">"2014-01-01"</span><span class="op">)</span>,</span>
<span>                       end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1989-12-31"</span>, <span class="st">"1997-12-31"</span>, </span>
<span>                               <span class="st">"2005-12-31"</span>, <span class="st">"2013-12-31"</span>, <span class="st">"2019-12-31"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="downloadprep-data">Download/prep data<a class="anchor" aria-label="anchor" href="#downloadprep-data"></a>
</h3>
<p>One could also use the <strong><code>plyr</code></strong> suite of
functions to automate the process of downloading and processing multiple
files, but I’ve chosen here to stick with the
<strong><code>tidyverse</code></strong> native approach. If the below
chunk of code fails or times out, simply re-run it until all of the data
have been downloaded.</p>
<p>It is worth pointing out here that these data are downloaded as
cached files on the users computer by using the
<strong><code>hoardr</code></strong> package. This means that if one
runs the same command again, it will not re-download the data because it
first looks in the folder where it has automatically cached the data for
you and sees that it may simply draw the data from there. No need to
change anything or write a second script for loading data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download all of the data with one nested request</span></span>
<span><span class="co"># The time this takes will vary greatly based on connection speed</span></span>
<span></span>
<span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu">OISST_sub_dl</span><span class="op">(</span><span class="va">dl_years</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">OISST_data</span> <span class="op">&lt;-</span> <span class="va">dl_years</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">date_index</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">group_modify</a></span><span class="op">(</span><span class="op">~</span><span class="fu">OISST_sub_dl</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, <span class="va">t</span>, <span class="va">temp</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="co"># 518 seconds, ~100 seconds per batch</span></span></code></pre></div>
<p>If the above code chunk is giving errors it is likely due to one’s
Internet connection timing out. There are also rare instances where the
NOAA server is not responding due to an issue on their end. Most
connection based issues may be resolved by simply waiting for a few
minutes, or by ensuring a stable connection.</p>
</div>
<div class="section level3">
<h3 id="visualise-data">Visualise data<a class="anchor" aria-label="anchor" href="#visualise-data"></a>
</h3>
<p>Before we save our data for later use it is good practice to
visualise them.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OISST_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">t</span> <span class="op">==</span> <span class="st">"2019-12-01"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># ggplot2::borders() + # Activate this line to see the global map</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="st">"SST (°C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="save-data">Save data<a class="anchor" aria-label="anchor" href="#save-data"></a>
</h3>
<p>With the data downloaded and prepared for further use (and a test
visual run), all that’s left to do is save them.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save the data as an .Rds file because it has a much better compression rate than .RData</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">OISST_data</span>, file <span class="op">=</span> <span class="st">"~/Desktop/OISST_vignette.Rds"</span><span class="op">)</span></span></code></pre></div>
<p>Note above that I have chosen to save the file to my desktop. This is
not normally where one (hopefully!) would save such a file. Rather one
would be saving these data into the project folder out of which one is
working. In the next vignette we will see how to <a href="https://robwschlegel.github.io/heatwaveR/articles/gridded_event_detection.html" class="external-link">detect
MHWs in gridded data</a> using the data downloaded here.</p>
</div>
</div>
<div class="section level2">
<h2 id="downloading-global-data">Downloading global data<a class="anchor" aria-label="anchor" href="#downloading-global-data"></a>
</h2>
<p>The method for downloading and preparing NOAA OISST data outlined in
the first half of this vignette should be considered best practice for
all applications except those that specifically need to look at the
entire globe. If one needs to download the global dataset then it is
preferable to go straight to the source. Note that one may still
download the full global dataset using the methods above by setting the
lon/lat extent to be the full width and height of the globe. The method
outlined below will download over 13,000 individual files. This makes
dealing with individual files very easy, but agglomerating them into one
file can be very time consuming.</p>
<div class="section level3">
<h3 id="file-information-1">File information<a class="anchor" aria-label="anchor" href="#file-information-1"></a>
</h3>
<p>The first step in downloading the full global dataset is to tell you
computer where they are. There is an automated way to do this but it
requires a couple of additional packages and we aim to keep this
vignette as simple and direct as possible. For our purposes today we
will manually create the URLs of the files we want to download.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First we tell R where the data are on the interwebs</span></span>
<span><span class="va">OISST_base_url</span> <span class="op">&lt;-</span> <span class="st">"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/"</span></span>
<span><span class="co"># Note that one may go to this URL in any web browser to manually inspect the files</span></span>
<span></span>
<span><span class="co"># Now we create a data.frame that contains all of the dates we want to download</span></span>
<span>  <span class="co"># NB: In order to change the dates download changes the dates in the following line</span></span>
<span><span class="va">OISST_dates</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2019-12-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2019-12-31"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To finish up this step we add some text to those dates so they match the OISST file names</span></span>
<span><span class="va">OISST_files</span> <span class="op">&lt;-</span> <span class="va">OISST_dates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>t_day <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">""</span>, <span class="va">t</span><span class="op">)</span>,</span>
<span>                t_month <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">t_day</span>, <span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>                t_year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>,</span>
<span>                file_name <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">OISST_base_url</span>, <span class="va">t_month</span>, <span class="st">"/"</span>, <span class="st">"oisst-avhrr-v02r01."</span>, <span class="va">t_day</span> ,<span class="st">".nc"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-data">Download data<a class="anchor" aria-label="anchor" href="#download-data"></a>
</h3>
<p>Now that we have a dataframe that contains all of the URLs for the
files we want to download we’ll create a function that will crawl
through those URLs and download the files for us.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This function will go about downloading each day of data as a NetCDF file</span></span>
<span><span class="co"># Note that this will download files into a 'data/OISST' folder in the root directory</span></span>
<span>  <span class="co"># If this folder does not exist it will create it</span></span>
<span>  <span class="co"># If it does not automatically create the folder it will need to be done manually</span></span>
<span>  <span class="co"># The folder that is created must be a new folder with no other files in it</span></span>
<span>  <span class="co"># A possible bug with netCDF files in R is they won't load correctly from </span></span>
<span>  <span class="co"># existing folders with other file types in them</span></span>
<span><span class="co"># This function will also check if the file has been previously downloaded</span></span>
<span>  <span class="co"># If it has it will not download it again</span></span>
<span><span class="va">OISST_url_daily_dl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">target_URL</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"~/data/OISST"</span>, showWarnings <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span>  <span class="va">file_name</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"~/data/OISST/"</span>,<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">target_URL</span>, split <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>, <span class="st">"[["</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">file_name</span><span class="op">)</span><span class="op">)</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">target_URL</span>, method <span class="op">=</span> <span class="st">"libcurl"</span>, destfile <span class="op">=</span> <span class="va">file_name</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># The more cores used, the faster the data may be downloaded</span></span>
<span>  <span class="co"># It is best practice to not use all of the cores on one's machine</span></span>
<span>  <span class="co"># The laptop on which I am running this code has 8 cores, so I use 7 here</span></span>
<span><span class="fu">doParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span>cores <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># And with that we are clear for take off</span></span>
<span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/l_ply.html" class="external-link">l_ply</a></span><span class="op">(</span><span class="va">OISST_files</span><span class="op">$</span><span class="va">file_name</span>, .fun <span class="op">=</span> <span class="va">OISST_url_daily_dl</span>, .parallel <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="co"># ~15 seconds</span></span>
<span></span>
<span><span class="co"># In roughly 15 seconds a user may have a full month of global data downloaded</span></span>
<span><span class="co"># This scales well into years and decades, and is much faster with more cores</span></span>
<span><span class="co"># Download speeds will also depend on the speed of the users internet connection</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h3>
<p>The following code chunk contains the function we may use to load and
prepare our OISST data for further use in R.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This function will load and subset daily data into one data.frame</span></span>
<span><span class="co"># Note that the subsetting by lon/lat is done before the data are loaded</span></span>
<span>  <span class="co"># This means it will use much less RAM and is viable for use on most laptops</span></span>
<span>  <span class="co"># Assuming one's study area is not too large</span></span>
<span><span class="va">OISST_load</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file_name</span>, <span class="va">lon1</span>, <span class="va">lon2</span>, <span class="va">lat1</span>, <span class="va">lat2</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">OISST_dat</span> <span class="op">&lt;-</span> <span class="fu">tidync</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tidync/reference/tidync.html" class="external-link">tidync</a></span><span class="op">(</span><span class="va">file_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">tidync</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tidync/reference/hyper_filter.html" class="external-link">hyper_filter</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lon1</span>, <span class="va">lon2</span><span class="op">)</span>,</span>
<span>                             lat <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">lat</span>, <span class="va">lat1</span>, <span class="va">lat2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu">tidync</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tidync/reference/hyper_tibble.html" class="external-link">hyper_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, <span class="va">time</span>, <span class="va">sst</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">time</span>, temp <span class="op">=</span> <span class="va">sst</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">t</span>, origin <span class="op">=</span> <span class="st">"1978-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">OISST_dat</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Locate the files that will be loaded</span></span>
<span><span class="va">OISST_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="st">"~/data/OISST"</span>, full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the data in parallel</span></span>
<span><span class="va">OISST_dat</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html" class="external-link">ldply</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">OISST_files</span>, .fun <span class="op">=</span> <span class="va">OISST_load</span>, .parallel <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                         lon1 <span class="op">=</span> <span class="fl">270</span>, lon2 <span class="op">=</span> <span class="fl">320</span>, lat1 <span class="op">=</span> <span class="fl">30</span>, lat2 <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># It should only take a few seconds to load one month of data depending on the size of the lon/lat extent chosen</span></span></code></pre></div>
<p>In the code chunk above I have chosen the spatial extent of longitude
270 to 320 and latitude 30 to 50. This a window over the Atlantic Coast
of North America. One may simply change the lon/lat values above as
necessary to match the desired study area. The function also re-labels
the ‘time’ column as ‘t’, and the ‘sst’ column as ‘temp’. We do this now
so that they match the default column names that are expected for
calculating MHWs so we won’t have to do any extra work later on.</p>
<p>Again, please note that trying to load too much data at once may be
too much for the RAM on one’s machine. If running the above code causes
one’s machine to hang, try loading a smaller subset of data. Or make
friends with someone with a server sized machine.</p>
</div>
<div class="section level3">
<h3 id="visualise-data-1">Visualise data<a class="anchor" aria-label="anchor" href="#visualise-data-1"></a>
</h3>
<p>It is always good to visualise data early and often in any workflow.
The code pipeline below shows how we can visualise a day of data from
those we’ve loaded.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OISST_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">t</span> <span class="op">==</span> <span class="st">"2019-12-01"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="st">"SST (°C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p>In the next vignette we will see how to <a href="https://robwschlegel.github.io/heatwaveR/articles/gridded_event_detection.html" class="external-link">detect
MHWs in gridded data</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robert W. Schlegel, Albertus J. Smit.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '2edc7627dae0471f3d765c3355bebbf3',
    indexName: 'heatwaver',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
