<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Downloading and Preparing NOAA OISST Data • heatwaveR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Downloading and Preparing NOAA OISST Data">
<meta property="og:description" content="This vignette demonstrates how to download NOAA OISST data and prepare them for the detection of marine heatwaves.">
<meta property="og:image" content="https://robwschlegel.github.io/heatwaveR/index.html/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-118123016-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118123016-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">heatwaveR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.2.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/detection_and_visualisation.html">Basic Detection and Visualisation of Events</a>
    </li>
    <li>
      <a href="../articles/exceedance.html">Calculating and Visualising Exceedances</a>
    </li>
    <li>
      <a href="../articles/event_categories.html">Calculating and Visualising Event Categories</a>
    </li>
    <li>
      <a href="../articles/OISST_preparation.html">Downloading and Preparing OISST Data</a>
    </li>
    <li>
      <a href="../articles/gridded_event_detection.html">Detecting Events in Gridded Data</a>
    </li>
    <li>
      <a href="../articles/complex_clims.html">Alternative Thresholds</a>
    </li>
  </ul>
</li>
<li>
  <a href="../CITATIONS.html">Citations</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/robwschlegel/heatwaveR">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Downloading and Preparing NOAA OISST Data</h1>
                        <h4 class="author">Robert W Schlegel and AJ Smit</h4>
            
            <h4 class="date">2020-06-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/robwschlegel/heatwaveR/blob/master/vignettes/OISST_preparation.Rmd"><code>vignettes/OISST_preparation.Rmd</code></a></small>
      <div class="hidden name"><code>OISST_preparation.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>In this vignette we will see how to retrieve and prepare <a href="https://journals.ametsoc.org/doi/full/10.1175/2007JCLI1824.1">Reynolds optimally interpolated sea surface temperature</a> (OISST) data for calculating marine heatwaves (MHWs). The OISST product is a global 1/4 degree gridded dataset of Advanced Very High Resolution Radiometer (AVHRR) derived SSTs at a daily resolution, starting on 1 September 1981. The source of the data is currently the <a href="https://www.ncdc.noaa.gov/oisst">NOAA NCDC</a>.</p>
<p>Each daily global file is available in netCDF format and is roughly 1.6 MB. This means that one full year of global data will be roughly 600 MB, and the full dataset roughly 25 GB. This is however when the data are very compressed. If we were to attempt to load the entire uncompressed dataset into our memory at once it would take more than 200 GB of RAM. That is well beyond the scope of any current laptop so in this vignette we will see how to download the full OISST dataset before then seeing how we can load only a subset of the data into the R environment for use with further analyses.</p>
</div>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>For this vignette we will be accessing the NOAA OISST dataset indexed <a href="https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/">here</a>. One may download the data there manually by clicking on each file individually. But programming languages like R are designed to prevent us from needing to experience that sort of anguish. Below we will load the libraries we need in order to have R download all of the files that we may need. If any of the lines of code in the following chunk do not run it means that we will need to first install that package. Uncomment the line of code that would install the problem package and run it before trying to load the library again.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># The two packages we will need</span>
  <span class="co"># NB: The packages only need to be installed from GitHub once</span>
<span class="co"># install.packages("dplyr")</span>
<span class="co"># install.packages("ggplot2")</span>
<span class="co"># install.packages("stringr")</span>
<span class="co"># install.packages("RCurl")</span>
<span class="co"># install.packages("XML")</span>
<span class="co"># install.packages("tidync")</span>
<span class="co"># install.packages("doParallel")</span>
<span class="co"># install.packages("plyr") # Note that this library is not explicitly loaded</span>
<span class="co"># install.packages("lubridate") # Note that this library is not explicitly loaded</span>

<span class="co"># Load the packages once they have been downloaded and installed</span>
<span class="co"># The packages we will use</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>) <span class="co"># A staple for most modern data management in R</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stringr</span>) <span class="co"># Used for easy manipulation of character strings</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>) <span class="co"># The preferred library for data visualisation</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">RCurl</span>) <span class="co"># For helping R to make sense of URLs for web hosted data</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">XML</span>) <span class="co"># For reading the HTML tables created by RCurl</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidync</span>) <span class="co"># For easily dealing with NetCDF data</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">doParallel</span>) <span class="co"># For parallel processing</span></pre></body></html></div>
<p>With our packages loaded we may now begin downloading data. We will break this step down into some key parts in order to keep this process as clear as possible. Before we begin I need to stress that this is a very direct and unrestricted method for accessing these data and I urge responsibility in only downloading as much data as are necessary. Please do not download the entire dataset unless you have a specific need for it.</p>
</div>
<div id="file-information" class="section level2">
<h2 class="hasAnchor">
<a href="#file-information" class="anchor"></a>File Information</h2>
<p>The first step in downloading the data is to tell you computer where they are. There are manual ways of doing this but we want to use code that we can run whenever we need and it will always be able to find the file names for us.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># First we tell R where the data are on the interwebs</span>
<span class="no">OISST_url_month</span> <span class="kw">&lt;-</span> <span class="st">"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/"</span>

<span class="co"># Then we pull that into a happy format</span>
  <span class="co"># There is a lot here so it takes ~1 minute</span>
<span class="no">OISST_url_month_get</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RCurl/man/getURL.html">getURL</a></span>(<span class="no">OISST_url_month</span>)

<span class="co"># Before we continue let's set a limit on the data we are going to download</span>
  <span class="co"># NB: One should not simply download the entire dataset just because it is possible.</span>
  <span class="co"># There should be a compelling reason for doing so.</span>
<span class="no">start_date</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2019-01-01"</span>)

<span class="co"># Now we strip away all of the unneeded stuff to get just the months of data that are available</span>
<span class="no">OISST_months</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">months</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/XML/man/readHTMLTable.html">readHTMLTable</a></span>(<span class="no">OISST_url_month_get</span>, <span class="kw">skip.rows</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">2</span>)<span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">Name</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">months</span> <span class="kw">=</span> <span class="kw pkg">lubridate</span><span class="kw ns">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span>(<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">months</span>), <span class="st">"/"</span>, <span class="st">"01"</span>))) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">months</span> <span class="kw">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="kw pkg">lubridate</span><span class="kw ns">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span>(<span class="no">start_date</span>, <span class="kw">unit</span> <span class="kw">=</span> <span class="st">"month"</span>))) <span class="kw">%&gt;%</span> <span class="co"># Filtering out months before Jan 2019</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">months</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"-"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span>(<span class="no">months</span>, <span class="fl">1</span>, <span class="fl">7</span>))) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>()

<span class="co"># Up next we need to now find the URLs for each individual day of data</span>
<span class="co"># To do this we will wrap the following chunk of code into a function so we can loop it more easily</span>
<span class="no">OISST_url_daily</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">target_month</span>){
  <span class="no">OISST_url</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">OISST_url_month</span>, <span class="no">target_month</span>,<span class="st">"/"</span>)
  <span class="no">OISST_url_get</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RCurl/man/getURL.html">getURL</a></span>(<span class="no">OISST_url</span>)
  <span class="no">OISST_table</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">files</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/XML/man/readHTMLTable.html">readHTMLTable</a></span>(<span class="no">OISST_url_get</span>, <span class="kw">skip.rows</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">2</span>)<span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">Name</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">files</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">files</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"avhrr"</span>, <span class="no">files</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">t</span> <span class="kw">=</span> <span class="kw pkg">lubridate</span><span class="kw ns">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span>(<span class="no">files</span>, <span class="st">"[.]"</span>), <span class="st">"[["</span>, <span class="fl">2</span>)),
           <span class="kw">full_name</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">OISST_url</span>, <span class="no">files</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">OISST_table</span>)
}

<span class="co"># Here we collect the URLs for every day of data available from 2019 onwards</span>
<span class="no">OISST_filenames</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="no">OISST_months</span>$<span class="no">months</span>, <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">OISST_url_daily</span>)

<span class="co"># Just to keep things tidy in this vignette I am now going to limit this data collection even further</span>
<span class="no">OISST_filenames</span> <span class="kw">&lt;-</span> <span class="no">OISST_filenames</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">t</span> <span class="kw">&lt;=</span> <span class="st">"2019-01-31"</span>)</pre></body></html></div>
</div>
<div id="downloading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#downloading-data" class="anchor"></a>Downloading data</h2>
<p>Now that we have a dataframe that contains all of the URLs for the files we want to download let’s create a function that will crawl through those URLs and download files for us.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># This function will go about downloading each day of data as a NetCDF file</span>
<span class="co"># Note that this will download files into a 'data/OISST' folder in the root directory</span>
  <span class="co"># If this folder does not exist it will create it</span>
<span class="co"># This function will also check if the file has been previously downloaded</span>
  <span class="co"># If it has it will not download it again</span>
<span class="no">OISST_url_daily_dl</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">target_URL</span>){
  <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="st">"~/data/OISST"</span>, <span class="kw">showWarnings</span> <span class="kw">=</span> <span class="no">F</span>)
  <span class="no">file_name</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"~/data/OISST/"</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span>(<span class="no">target_URL</span>, <span class="kw">split</span> <span class="kw">=</span> <span class="st">"/"</span>), <span class="st">"[["</span>, <span class="fl">10</span>))
  <span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="no">file_name</span>)) <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(<span class="kw">url</span> <span class="kw">=</span> <span class="no">target_URL</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"libcurl"</span>, <span class="kw">destfile</span> <span class="kw">=</span> <span class="no">file_name</span>)
}

<span class="co"># The way this code has been written it may be run on multiple cores</span>
<span class="co"># Most modern laptops have at least 4 cores, so we will utilise 3 of them here</span>
<span class="co"># The more cores used, the faster the data may be downloaded</span>
<span class="kw pkg">doParallel</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span>(<span class="kw">cores</span> <span class="kw">=</span> <span class="fl">3</span>)

<span class="co"># And with that we are clear for take off</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(<span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/l_ply.html">l_ply</a></span>(<span class="no">OISST_filenames</span>$<span class="no">full_name</span>, <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">OISST_url_daily_dl</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>)) <span class="co"># ~15 seconds</span>

<span class="co"># In roughly 15 seconds a user may have a full month of global data downloaded</span>
<span class="co"># This scales well into years and decades, and is much faster with more cores</span></pre></body></html></div>
</div>
<div id="loading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-data" class="anchor"></a>Loading data</h2>
<p>The following code chunk contains the function we may use to load and prepare our OISST data for further use in R.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># This function will load and subset daily data into one data.frame</span>
<span class="co"># Note that the subsetting by lon/lat is done before the data are loaded</span>
<span class="co"># This means it will use much less RAM and is viable for use on most laptops</span>
<span class="co"># Assuming one's study area is not too large</span>
<span class="no">OISST_load</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">file_name</span>, <span class="no">lon1</span>, <span class="no">lon2</span>, <span class="no">lat1</span>, <span class="no">lat2</span>){
      <span class="no">OISST_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/tidync/reference/tidync.html">tidync</a></span>(<span class="no">file_name</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://docs.ropensci.org/tidync/reference/hyper_filter.html">hyper_filter</a></span>(<span class="kw">lon</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span>(<span class="no">lon</span>, <span class="no">lon1</span>, <span class="no">lon2</span>),
                     <span class="kw">lat</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span>(<span class="no">lat</span>, <span class="no">lat1</span>, <span class="no">lat2</span>)) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://docs.ropensci.org/tidync/reference/hyper_tibble.html">hyper_tibble</a></span>() <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">lon</span>, <span class="no">lat</span>, <span class="no">time</span>, <span class="no">sst</span>) <span class="kw">%&gt;%</span>
        <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">t</span> <span class="kw">=</span> <span class="no">time</span>, <span class="kw">temp</span> <span class="kw">=</span> <span class="no">sst</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">t</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="no">t</span>, <span class="kw">origin</span> <span class="kw">=</span> <span class="st">"1978-01-01"</span>))
      <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">OISST_dat</span>)
}

<span class="co"># Locate the files that will be loaded</span>
<span class="no">OISST_files</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>(<span class="st">"~/data/OISST"</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="no">T</span>)

<span class="co"># Load the data in parallel</span>
<span class="no">OISST_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(<span class="kw">.data</span> <span class="kw">=</span> <span class="no">OISST_files</span>, <span class="kw">.fun</span> <span class="kw">=</span> <span class="no">OISST_load</span>, <span class="kw">.parallel</span> <span class="kw">=</span> <span class="no">T</span>,
                         <span class="kw">lon1</span> <span class="kw">=</span> <span class="fl">270</span>, <span class="kw">lon2</span> <span class="kw">=</span> <span class="fl">320</span>, <span class="kw">lat1</span> <span class="kw">=</span> <span class="fl">30</span>, <span class="kw">lat2</span> <span class="kw">=</span> <span class="fl">50</span>)

<span class="co"># It should only take a few seconds to load one month of data depending on the size of the lon/lat extent chosen</span></pre></body></html></div>
<p>In the code chunk above I have chosen the spatial extent of longitude 270 to 320 and latitude 30 to 50. This a window over the Atlantic Coast of North America. One may simply change the lon/lat values above as necessary to match the desired study area. The function also re-labels the ‘time’ column as ‘t’, and the ‘sst’ column as ‘temp’. We do this now so that they match the default column names that are expected for calculating MHWs so we won’t have to do any extra work later on.</p>
<p>One must note here that depending on the RAM available on one’s machine, it may not be possible to handle all of the data loaded at once if they are very large (e.g. &gt; 5 GB). The discussion on the limitations of the R language due to its dependence on virtual memory is beyond the scope of this vignette, but if one limits one’s lon/lat range to no more than several degrees on lon/lat at once that should be fine for almost all machines. Were one to try to load 30+ years of the data for the whole Indian Ocean, for example, that may cause issues if being run on a laptop or computer of a similar power.</p>
</div>
<div id="visualising-data" class="section level2">
<h2 class="hasAnchor">
<a href="#visualising-data" class="anchor"></a>Visualising data</h2>
<p>To wrap this vignette up we will see a code pipeline we can use to visualise a day of data from those we’ve loaded.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">OISST_dat</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">t</span> <span class="kw">==</span> <span class="st">"2019-01-01"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">lon</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">lat</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">temp</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html">coord_quickmap</a></span>(<span class="kw">expand</span> <span class="kw">=</span> <span class="no">F</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"SST (°C)"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)</pre></body></html></div>
<p>In the next vignette we will see how to <a href="https://robwschlegel.github.io/heatwaveR/articles/gridded_event_detection.html">detect MHWs in gridded data</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Robert W. Schlegel, Albertus J. Smit.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '2edc7627dae0471f3d765c3355bebbf3',
    indexName: 'heatwaver',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
