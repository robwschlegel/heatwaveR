<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic Detection and Visualisation of Events • heatwaveR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Basic Detection and Visualisation of Events">
<meta property="og:description" content="This vignette demonstrates the basic use of the heatwaveR package for the detection and visualisation of events.">
<meta property="og:image" content="https://robwschlegel.github.io/heatwaveR/index.html/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-118123016-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118123016-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">heatwaveR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.2.9009</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/detection_and_visualisation.html">Basic Detection and Visualisation of Events</a>
    </li>
    <li>
      <a href="../articles/event_categories.html">Calculating and Visualising Event Categories</a>
    </li>
    <li>
      <a href="../articles/exceedance.html">Calculating and Visualising Exceedances</a>
    </li>
    <li>
      <a href="../articles/complex_clims.html">Alternative Thresholds</a>
    </li>
    <li>
      <a href="../articles/MHW_metric_trends.html">Trend and Breakpoint Analyses</a>
    </li>
    <li>
      <a href="../articles/OISST_preparation.html">Downloading and Preparing OISST Data</a>
    </li>
    <li>
      <a href="../articles/gridded_event_detection.html">Detecting Events in Gridded Data</a>
    </li>
    <li>
      <a href="../articles/Download_SST_v2.html">Download, Prepare, and Analyse Data: Alternative</a>
    </li>
    <li>
      <a href="../articles/MHW_to_nc.html">Saving MHW Results to NetCDF</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://193.50.85.71:3838/demoMHW/" class="external-link">Tutorial</a>
</li>
<li>
  <a href="../CITATIONS.html">Citations</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/robwschlegel/heatwaveR" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Basic Detection and Visualisation of Events</h1>
                        <h4 data-toc-skip class="author">AJ Smit and
Robert W Schlegel</h4>
            
            <h4 data-toc-skip class="date">2024-01-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/robwschlegel/heatwaveR/blob/HEAD/vignettes/detection_and_visualisation.Rmd" class="external-link"><code>vignettes/detection_and_visualisation.Rmd</code></a></small>
      <div class="hidden name"><code>detection_and_visualisation.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>The <code><a href="../reference/detect_event.html">detect_event()</a></code> function is the core of this package,
and it expects to be fed the output of the second core function,
<code><a href="../reference/ts2clm.html">ts2clm()</a></code>. By default, <code><a href="../reference/ts2clm.html">ts2clm()</a></code> wants to
receive a two-column dataframe with one column labelled <code>t</code>
containing all of the date values, and a second column <code>temp</code>
containing all of the temperature values. Please note that the date
format it expects is “YYYY-MM-DD”. For example, please see the top five
rows of one of the datasets included with the
<strong><code>heatwaveR</code></strong> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">heatwaveR</span><span class="fu">::</span><span class="va"><a href="../reference/sst_WA.html">sst_WA</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">##   t           temp</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 1982-01-01  20.9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 1982-01-02  21.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 1982-01-03  21.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 1982-01-04  21.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 1982-01-05  21.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 1982-01-06  21.6</span></span></code></pre>
<p>It is possible to use different column names other than
<code>t</code> and <code>temp</code> with which to calculate events.
Please see the help files for <code><a href="../reference/ts2clm.html">ts2clm()</a></code> or
<code><a href="../reference/detect_event.html">detect_event()</a></code> for a thorough explanation of how to do
so.</p>
<p>Loading ones data from a <code>.csv</code> file or other text based
format is the easiest approach for the calculation of events, assuming
one is not working with gridded data (e.g. NetCDF). Please see <a href="https://robwschlegel.github.io/heatwaveR/articles/gridded_event_detection.html" class="external-link">this
vignette</a> for a detailed walkthrough on using the functions in this
package with gridded data.</p>
</div>
<div class="section level2">
<h2 id="calculating-marine-heatwaves-mhws">Calculating marine heatwaves (MHWs)<a class="anchor" aria-label="anchor" href="#calculating-marine-heatwaves-mhws"></a>
</h2>
<p>Here are the <code><a href="../reference/ts2clm.html">ts2clm()</a></code> and <code><a href="../reference/detect_event.html">detect_event()</a></code>
function applied to the Western Australia test data included with this
package (<code>sst_WA</code>), which are also discussed by Hobday et
al. (2016):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://robwschlegel.github.io/heatwaveR/index.html">heatwaveR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Detect the events in a time series</span></span>
<span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts2clm.html">ts2clm</a></span><span class="op">(</span><span class="va">sst_WA</span>, climatologyPeriod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1982-01-01"</span>, <span class="st">"2011-12-31"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mhw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect_event.html">detect_event</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View just a few metrics</span></span>
<span><span class="va">mhw</span><span class="op">$</span><span class="va">event</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">event_no</span>, <span class="va">duration</span>, <span class="va">date_start</span>, <span class="va">date_peak</span>, <span class="va">intensity_max</span>, <span class="va">intensity_cumulative</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">intensity_max</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   event_no duration date_start  date_peak intensity_max intensity_cumulative</span></span>
<span><span class="co">## 1       52      105 2010-12-24 2011-02-28        6.5798             293.2107</span></span>
<span><span class="co">## 2       41       35 2008-03-25 2008-04-14        3.8299              79.3307</span></span>
<span><span class="co">## 3       29       95 1999-05-13 1999-05-22        3.6390             240.2994</span></span>
<span><span class="co">## 4       60       14 2012-12-27 2012-12-31        3.4230              32.2560</span></span>
<span><span class="co">## 5       59      101 2012-01-10 2012-01-27        3.3804             214.0509</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="visualising-marine-heatwaves-mhws">Visualising marine heatwaves (MHWs)<a class="anchor" aria-label="anchor" href="#visualising-marine-heatwaves-mhws"></a>
</h2>
<div class="section level3">
<h3 id="default-mhw-visuals">Default MHW visuals<a class="anchor" aria-label="anchor" href="#default-mhw-visuals"></a>
</h3>
<p>One may use <code><a href="../reference/event_line.html">event_line()</a></code> and <code><a href="../reference/lolli_plot.html">lolli_plot()</a></code>
directly on the output of <code><a href="../reference/detect_event.html">detect_event()</a></code> in order to
visualise MHWs. Here are the functions being used to visualise the
massive Western Australian heatwave of 2011:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/event_line.html">event_line</a></span><span class="op">(</span><span class="va">mhw</span>, spread <span class="op">=</span> <span class="fl">180</span>, metric <span class="op">=</span> <span class="va">intensity_max</span>, </span>
<span>           start_date <span class="op">=</span> <span class="st">"1982-01-01"</span>, end_date <span class="op">=</span> <span class="st">"2014-12-31"</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/fig-example1-1.png" width="768"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lolli_plot.html">lolli_plot</a></span><span class="op">(</span><span class="va">mhw</span>, metric <span class="op">=</span> <span class="va">intensity_max</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/fig-example1-2.png" width="768"><!-- ![](vignettes/fig-example1-1.png) --><!-- ![](vignettes/fig-example2-1.png) --></p>
</div>
<div class="section level3">
<h3 id="custom-mhw-visuals">Custom MHW visuals<a class="anchor" aria-label="anchor" href="#custom-mhw-visuals"></a>
</h3>
<p>The <code><a href="../reference/event_line.html">event_line()</a></code> and <code><a href="../reference/lolli_plot.html">lolli_plot()</a></code> functions
were designed to work directly on the list returned by
<code><a href="../reference/detect_event.html">detect_event()</a></code>. If more control over the figures is
required, it may be useful to create them in
<strong><code>ggplot2</code></strong> by stacking <code>geoms</code>. We
specifically created two new <strong><code>ggplot2</code></strong>
<code>geoms</code> to reproduce the functionality of
<code><a href="../reference/event_line.html">event_line()</a></code> and <code><a href="../reference/lolli_plot.html">lolli_plot()</a></code>. These functions
are more general in their functionality and can be used outside of the
<strong><code>heatwaveR</code></strong> package, too. To apply them to
MHWs and MCSs first requires that we access the <code>climatology</code>
or <code>event</code> dataframes within the list that is produced by
<code><a href="../reference/detect_event.html">detect_event()</a></code>. Here is how:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select the region of the time series of interest</span></span>
<span><span class="va">mhw2</span> <span class="op">&lt;-</span> <span class="va">mhw</span><span class="op">$</span><span class="va">climatology</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">10580</span><span class="op">:</span><span class="fl">10720</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mhw2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">temp</span>, y2 <span class="op">=</span> <span class="va">thresh</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_flame.html">geom_flame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2011-02-25"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">25.8</span>, label <span class="op">=</span> <span class="st">"the Destroyer\nof Kelps"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/fig-example2-1.png" width="768"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mhw</span><span class="op">$</span><span class="va">event</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_start</span>, y <span class="op">=</span> <span class="va">intensity_max</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_lolli.html">geom_lolli</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"salmon"</span>, colour_n <span class="op">=</span> <span class="st">"red"</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2006-08-01"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                label <span class="op">=</span> <span class="st">"The marine heatwaves\nTend to be left skewed in a\nGiven time series"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Max. intensity ["</span>, <span class="va">degree</span>, <span class="st">"C]"</span><span class="op">)</span><span class="op">)</span>, x <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/fig-example2-2.png" width="768"><!-- ![](vignettes/fig-example3-1.png) --><!-- ![](vignettes/fig-example3-2.png) --></p>
</div>
<div class="section level3">
<h3 id="spicy-mhw-visuals">Spicy MHW visuals<a class="anchor" aria-label="anchor" href="#spicy-mhw-visuals"></a>
</h3>
<p>The default output of these function may not be to your liking. If
so, not to worry. As <strong><code>ggplot2</code></strong>
<code>geoms</code>, they are highly malleable. For example, if we were
to choose to reproduce the format of the MHWs as seen in Hobday et
al. (2016), the code would look something like this:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># It is necessary to give geom_flame() at least one row on either side of </span></span>
<span><span class="co"># the event in order to calculate the polygon corners smoothly</span></span>
<span><span class="va">mhw_top</span> <span class="op">&lt;-</span> <span class="va">mhw2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">111</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mhw2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_flame.html">geom_flame</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">temp</span>, y2 <span class="op">=</span> <span class="va">thresh</span>, fill <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_flame.html">geom_flame</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mhw_top</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">temp</span>, y2 <span class="op">=</span> <span class="va">thresh</span>, fill <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span>,  show.legend <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">temp</span>, colour <span class="op">=</span> <span class="st">"temp"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">thresh</span>, colour <span class="op">=</span> <span class="st">"thresh"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">seas</span>, colour <span class="op">=</span> <span class="st">"seas"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Line Colour"</span>,</span>
<span>                      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp"</span> <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                                 <span class="st">"thresh"</span> <span class="op">=</span>  <span class="st">"forestgreen"</span>, </span>
<span>                                 <span class="st">"seas"</span> <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Event Colour"</span>, </span>
<span>                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span> <span class="op">=</span> <span class="st">"salmon"</span>, </span>
<span>                               <span class="st">"top"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b %Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Temperature ["</span>, <span class="va">degree</span>, <span class="st">"C]"</span><span class="op">)</span><span class="op">)</span>, x <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/fig-example3-1.png" width="768"><!-- ![](vignettes/fig-example4-1.png) --></p>
<p>It is also worth pointing out that when we use
<code><a href="../reference/geom_flame.html">geom_flame()</a></code> directly like this, but we don’t want to
highlight events greater less than our standard five day length,
allowing for a two day gap, we want to use the arguments <code>n</code>
and <code>n_gap</code> respectively.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mhw3</span> <span class="op">&lt;-</span> <span class="va">mhw</span><span class="op">$</span><span class="va">climatology</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">850</span><span class="op">:</span><span class="fl">950</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mhw3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">temp</span>, y2 <span class="op">=</span> <span class="va">thresh</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_flame.html">geom_flame</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Note the use of n = 5 and n_gap = 2 below</span></span>
<span>  <span class="fu"><a href="../reference/geom_flame.html">geom_flame</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span>, n_gap <span class="op">=</span> <span class="fl">2</span>, fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1984-05-16"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">24.5</span>,</span>
<span>                label <span class="op">=</span> <span class="st">"heat\n\n\n\n\nspike"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/flame_gaps-1.png" width="768"></p>
<p>Should we not wish to highlight any events with
<code><a href="../reference/geom_lolli.html">geom_lolli()</a></code>, plot them with a colour other than the
default, and use a different theme, it would look like this:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mhw</span><span class="op">$</span><span class="va">event</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_peak</span>, y <span class="op">=</span> <span class="va">intensity_max</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_lolli.html">geom_lolli</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"firebrick"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Peak Date"</span>, </span>
<span>       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Max. intensity ["</span>, <span class="va">degree</span>, <span class="st">"C]"</span><span class="op">)</span><span class="op">)</span>, x <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_linedraw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/fig-example4-1.png" width="768"><!-- ![](vignettes/fig-example5-1.png) --></p>
<p>Because these are simple <strong><code>ggplot2</code></strong> geoms
possibilities are nearly infinite.</p>
</div>
</div>
<div class="section level2">
<h2 id="calculating-marine-cold-spells-mcss">Calculating marine cold-spells (MCSs)<a class="anchor" aria-label="anchor" href="#calculating-marine-cold-spells-mcss"></a>
</h2>
<p>The calculation and visualisation of cold-spells is also provided for
within this package. The data to be fed into the functions is the same
as for MHWs. The main difference is that one is now calculating the 10th
percentile threshold, rather than the 90th percentile threshold. Here
are the top five cold-spells (cumulative intensity) detected in the
OISST data for Western Australia:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First calculate the cold-spells</span></span>
<span><span class="va">ts_10th</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts2clm.html">ts2clm</a></span><span class="op">(</span><span class="va">sst_WA</span>, climatologyPeriod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1982-01-01"</span>, <span class="st">"2011-12-31"</span><span class="op">)</span>, pctile <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">mcs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect_event.html">detect_event</a></span><span class="op">(</span><span class="va">ts_10th</span>, coldSpells <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then look at the top few events</span></span>
<span><span class="va">mcs</span><span class="op">$</span><span class="va">event</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">event_no</span>, <span class="va">duration</span>, <span class="va">date_start</span>,</span>
<span>                <span class="va">date_peak</span>, <span class="va">intensity_mean</span>, <span class="va">intensity_max</span>, <span class="va">intensity_cumulative</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">intensity_cumulative</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   event_no duration date_start  date_peak intensity_mean intensity_max</span></span>
<span><span class="co">## 1       15       76 1990-04-13 1990-05-11        -2.5027       -3.1883</span></span>
<span><span class="co">## 2       49       58 2003-12-19 2004-01-23        -1.7341       -2.5865</span></span>
<span><span class="co">## 3       83       41 2020-04-26 2020-05-25        -2.3374       -3.1433</span></span>
<span><span class="co">## 4       64       52 2014-04-14 2014-05-05        -1.7824       -2.5358</span></span>
<span><span class="co">## 5       77       46 2018-07-24 2018-08-02        -1.8096       -2.4311</span></span>
<span><span class="co">##   intensity_cumulative</span></span>
<span><span class="co">## 1            -190.2043</span></span>
<span><span class="co">## 2            -100.5806</span></span>
<span><span class="co">## 3             -95.8339</span></span>
<span><span class="co">## 4             -92.6844</span></span>
<span><span class="co">## 5             -83.2407</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="visualising-marine-cold-spells-mcss">Visualising marine cold-spells (MCSs)<a class="anchor" aria-label="anchor" href="#visualising-marine-cold-spells-mcss"></a>
</h2>
<div class="section level3">
<h3 id="default-mcs-visuals">Default MCS visuals<a class="anchor" aria-label="anchor" href="#default-mcs-visuals"></a>
</h3>
<p>The default plots showing cold-spells look like this:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/event_line.html">event_line</a></span><span class="op">(</span><span class="va">mcs</span>, spread <span class="op">=</span> <span class="fl">200</span>, metric <span class="op">=</span> <span class="va">intensity_cumulative</span>,</span>
<span>           start_date <span class="op">=</span> <span class="st">"1982-01-01"</span>, end_date <span class="op">=</span> <span class="st">"2014-12-31"</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/fig-example5-1.png" width="768"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lolli_plot.html">lolli_plot</a></span><span class="op">(</span><span class="va">mcs</span>, metric <span class="op">=</span> <span class="va">intensity_cumulative</span>, xaxis <span class="op">=</span> <span class="va">event_no</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/fig-example5-2.png" width="768"><!-- ![](vignettes/fig-example6-1.png) --><!-- ![](vignettes/fig-example6-2.png) --></p>
<p>Note that one does not need to specify that MCSs are to be
visualised, the functions are able to understand this on their own.</p>
</div>
<div class="section level3">
<h3 id="custom-mcs-visuals">Custom MCS visuals<a class="anchor" aria-label="anchor" href="#custom-mcs-visuals"></a>
</h3>
<p>Cold spell figures may be created as <code>geoms</code> in
<strong><code>ggplot2</code></strong>, too:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select the region of the time series of interest</span></span>
<span><span class="va">mcs2</span> <span class="op">&lt;-</span> <span class="va">mcs</span><span class="op">$</span><span class="va">climatology</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">2900</span><span class="op">:</span><span class="fl">3190</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note that one must specify a colour other than the default 'salmon'</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mcs2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">thresh</span>, y2 <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_flame.html">geom_flame</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"steelblue3"</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/fig-example6-1.png" width="768"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mcs</span><span class="op">$</span><span class="va">event</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_start</span>, y <span class="op">=</span> <span class="va">intensity_max</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_lolli.html">geom_lolli</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"steelblue3"</span>, colour_n <span class="op">=</span> <span class="st">"navy"</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Start Date"</span>,</span>
<span>       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Max. intensity ["</span>, <span class="va">degree</span>, <span class="st">"C]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/fig-example6-2.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="minty-mcs-visuals">Minty MCS visuals<a class="anchor" aria-label="anchor" href="#minty-mcs-visuals"></a>
</h3>
<p>Again, because <code><a href="../reference/geom_flame.html">geom_flame()</a></code> and
<code><a href="../reference/geom_lolli.html">geom_lolli()</a></code> are simple
<strong><code>ggplot2</code></strong> geoms, one can go completely
bananas with them:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcs_top</span> <span class="op">&lt;-</span> <span class="va">mcs2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">125</span><span class="op">:</span><span class="fl">202</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mcs2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_flame.html">geom_flame</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">thresh</span>, y2 <span class="op">=</span> <span class="va">temp</span>, fill <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_flame.html">geom_flame</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mcs_top</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">thresh</span>, y2 <span class="op">=</span> <span class="va">temp</span>, fill <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">temp</span>, colour <span class="op">=</span> <span class="st">"temp"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">thresh</span>, colour <span class="op">=</span> <span class="st">"thresh"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">seas</span>, colour <span class="op">=</span> <span class="st">"seas"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Line Colour"</span>,</span>
<span>                      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"thresh"</span> <span class="op">=</span>  <span class="st">"forestgreen"</span>, <span class="st">"seas"</span> <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Event Colour"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span> <span class="op">=</span> <span class="st">"steelblue3"</span>, <span class="st">"top"</span> <span class="op">=</span> <span class="st">"navy"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b %Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Temperature ["</span>, <span class="va">degree</span>, <span class="st">"C]"</span><span class="op">)</span><span class="op">)</span>, x <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/fig-example7-1.png" width="768"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mcs</span><span class="op">$</span><span class="va">event</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_start</span>, y <span class="op">=</span> <span class="va">intensity_cumulative</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_lolli.html">geom_lolli</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"steelblue3"</span>, colour_n <span class="op">=</span> <span class="st">"navy"</span>, n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span> x <span class="op">=</span> <span class="st">"Start Date"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Cumulative intensity [days x "</span>, <span class="va">degree</span>, <span class="st">"C]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="detection_and_visualisation_files/figure-html/fig-example7-2.png" width="768"><!-- ![](vignettes/fig-example7-1.png) --><!-- ![](vignettes/fig-example7-2.png) --></p>
</div>
</div>
<div class="section level2">
<h2 id="interactive-visuals">Interactive visuals<a class="anchor" aria-label="anchor" href="#interactive-visuals"></a>
</h2>
<p>As of <strong><code>heatwaveR</code></strong> v0.3.6.9002,
<code><a href="../reference/geom_flame.html">geom_flame()</a></code> was also able to be used with
<strong><code>plotly</code></strong> to allow for interactive MHW
visuals. Unfortunately around December of 2020 the
<strong><code>plotly</code></strong> packaged was orphaned and CRAN
decided it didn’t want packages to include it as an imported package.
Therefore as of v0.4.4.9005 <strong><code>heatwaveR</code></strong> no
longer has built in support for using <code><a href="../reference/geom_flame.html">geom_flame()</a></code> with
<strong><code>plotly</code></strong>. It is however still possible with
a bit of work and a simple working example is given below. It is not
currently possible to use <code><a href="../reference/geom_lolli.html">geom_lolli()</a></code> with
<strong><code>plotly</code></strong>. Rather one is advised to just
create the dots and segments separately with <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point()</a></code>
and <code><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment()</a></code> respectively as these are already
recognised by <strong><code>plotly</code></strong>.</p>
<p>Note that the following code chunk is not run as it makes this
vignette a bit too large.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Must load plotly library first</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Function needed for making geom_flame() work with plotly</span></span>
<span><span class="va">geom2trace.GeomFlame</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">data</span>,</span>
<span>                                  <span class="va">params</span>,</span>
<span>                                  <span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y2</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="co"># Create data.frame for ease of use</span></span>
<span>  <span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data</span><span class="op">[[</span><span class="st">"x"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                      y <span class="op">=</span> <span class="va">data</span><span class="op">[[</span><span class="st">"y"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                      y2 <span class="op">=</span> <span class="va">data</span><span class="op">[[</span><span class="st">"y2"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Grab parameters</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">[[</span><span class="st">"n"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">n_gap</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">[[</span><span class="st">"n_gap"</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Find events that meet minimum length requirement</span></span>
<span>  <span class="va">data_event</span> <span class="op">&lt;-</span> <span class="fu">heatwaveR</span><span class="fu">::</span><span class="fu"><a href="../reference/detect_event.html">detect_event</a></span><span class="op">(</span><span class="va">data1</span>, x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                        seasClim <span class="op">=</span> <span class="va">y</span>,</span>
<span>                                        threshClim <span class="op">=</span> <span class="va">y2</span>,</span>
<span>                                        minDuration <span class="op">=</span> <span class="va">n</span>,</span>
<span>                                        maxGap <span class="op">=</span> <span class="va">n_gap</span>,</span>
<span>                                        protoEvents <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Detect spikes</span></span>
<span>  <span class="va">data_event</span><span class="op">$</span><span class="va">screen</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data_event</span><span class="op">$</span><span class="va">threshCriterion</span> <span class="op">==</span> <span class="cn">FALSE</span>, <span class="cn">FALSE</span>,</span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">data_event</span><span class="op">$</span><span class="va">event</span> <span class="op">==</span> <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Screen out spikes</span></span>
<span>  <span class="va">data1</span> <span class="op">&lt;-</span> <span class="va">data1</span><span class="op">[</span><span class="va">data_event</span><span class="op">$</span><span class="va">screen</span> <span class="op">!=</span> <span class="cn">TRUE</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Prepare to find the polygon corners</span></span>
<span>  <span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">data1</span><span class="op">$</span><span class="va">y</span></span>
<span>  <span class="va">x2</span> <span class="op">&lt;-</span> <span class="va">data1</span><span class="op">$</span><span class="va">y2</span></span>
<span>  </span>
<span>  <span class="co"># # Find points where x1 is above x2.</span></span>
<span>  <span class="va">above</span> <span class="op">&lt;-</span> <span class="va">x1</span> <span class="op">&gt;</span> <span class="va">x2</span></span>
<span>  <span class="va">above</span><span class="op">[</span><span class="va">above</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">above</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">above</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  </span>
<span>  <span class="co"># Points always intersect when above=TRUE, then FALSE or reverse</span></span>
<span>  <span class="va">intersect.points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">above</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Find the slopes for each line segment.</span></span>
<span>  <span class="va">x1.slopes</span> <span class="op">&lt;-</span> <span class="va">x1</span><span class="op">[</span><span class="va">intersect.points</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x1</span><span class="op">[</span><span class="va">intersect.points</span><span class="op">]</span></span>
<span>  <span class="va">x2.slopes</span> <span class="op">&lt;-</span> <span class="va">x2</span><span class="op">[</span><span class="va">intersect.points</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x2</span><span class="op">[</span><span class="va">intersect.points</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># # Find the intersection for each segment.</span></span>
<span>  <span class="va">x.points</span> <span class="op">&lt;-</span> <span class="va">intersect.points</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="va">x2</span><span class="op">[</span><span class="va">intersect.points</span><span class="op">]</span> <span class="op">-</span> <span class="va">x1</span><span class="op">[</span><span class="va">intersect.points</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">x1.slopes</span> <span class="op">-</span> <span class="va">x2.slopes</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">y.points</span> <span class="op">&lt;-</span> <span class="va">x1</span><span class="op">[</span><span class="va">intersect.points</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="va">x1.slopes</span> <span class="op">*</span> <span class="op">(</span><span class="va">x.points</span> <span class="op">-</span> <span class="va">intersect.points</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Coerce x.points to the same scale as x</span></span>
<span>  <span class="va">x_gap</span> <span class="op">&lt;-</span> <span class="va">data1</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">data1</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">x.points</span> <span class="op">&lt;-</span> <span class="va">data1</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="va">intersect.points</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="va">x_gap</span><span class="op">*</span><span class="op">(</span><span class="va">x.points</span> <span class="op">-</span> <span class="va">intersect.points</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Create new data frame and merge to introduce new rows of data</span></span>
<span>  <span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data1</span><span class="op">$</span><span class="va">y</span>, <span class="va">y.points</span><span class="op">)</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data1</span><span class="op">$</span><span class="va">x</span>, <span class="va">x.points</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data2</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">data3</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">data1</span>, <span class="va">data2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>, all.y <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="va">data3</span><span class="op">$</span><span class="va">y2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">data3</span><span class="op">$</span><span class="va">y2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data3</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">data3</span><span class="op">$</span><span class="va">y2</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Remove missing values for better plotting</span></span>
<span>  <span class="va">data3</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">data3</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;</span> <span class="va">data3</span><span class="op">$</span><span class="va">y2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>  <span class="va">missing_pos</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">data3</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"y2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">missing_pos</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">ids</span><span class="op">[</span><span class="va">missing_pos</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>  </span>
<span>  <span class="co"># Get the correct positions</span></span>
<span>  <span class="va">positions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data3</span><span class="op">$</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">data3</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data3</span><span class="op">$</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">data3</span><span class="op">$</span><span class="va">y2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ids</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Convert to a format geom2trace is happy with</span></span>
<span>  <span class="va">positions</span> <span class="op">&lt;-</span> <span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/group2NA.html" class="external-link">group2NA</a></span><span class="op">(</span><span class="va">positions</span>, groupNames <span class="op">=</span> <span class="st">"ids"</span><span class="op">)</span></span>
<span>  <span class="va">positions</span> <span class="op">&lt;-</span> <span class="va">positions</span><span class="op">[</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">positions</span><span class="op">$</span><span class="va">ids</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">positions</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">positions</span>, <span class="va">data</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">positions</span><span class="op">$</span><span class="va">PANEL</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> </span>
<span>    <span class="va">positions</span><span class="op">$</span><span class="va">PANEL</span> <span class="op">&lt;-</span> <span class="va">positions</span><span class="op">$</span><span class="va">PANEL</span><span class="op">[</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">positions</span><span class="op">$</span><span class="va">PANEL</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">positions</span><span class="op">$</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> </span>
<span>    <span class="va">positions</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="va">positions</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">positions</span><span class="op">$</span><span class="va">group</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Run the plotly polygon code</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">positions</span><span class="op">$</span><span class="va">PANEL</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">getFromNamespace</a></span><span class="op">(</span><span class="st">"geom2trace.GeomPolygon"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html" class="external-link">asNamespace</a></span><span class="op">(</span><span class="st">"plotly"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="va">positions</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Time series</span></span>
<span><span class="va">ts_res</span> <span class="op">&lt;-</span> <span class="fu">heatwaveR</span><span class="fu">::</span><span class="fu"><a href="../reference/ts2clm.html">ts2clm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">heatwaveR</span><span class="fu">::</span><span class="va"><a href="../reference/sst_WA.html">sst_WA</a></span>,</span>
<span>                            climatologyPeriod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1982-01-01"</span>, <span class="st">"2011-12-31"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ts_res_sub</span> <span class="op">&lt;-</span> <span class="va">ts_res</span><span class="op">[</span><span class="fl">10500</span><span class="op">:</span><span class="fl">10800</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Flame Figure</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ts_res_sub</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">heatwaveR</span><span class="fu">::</span><span class="fu"><a href="../reference/geom_flame.html">geom_flame</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y2 <span class="op">=</span> <span class="va">thresh</span><span class="op">)</span>, n <span class="op">=</span> <span class="fl">5</span>, n_gap <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">seas</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">thresh</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Temperature (°C)"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create interactive visuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robert W. Schlegel, Albertus J. Smit.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '2edc7627dae0471f3d765c3355bebbf3',
    indexName: 'heatwaver',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
