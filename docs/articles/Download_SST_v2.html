<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Download, Prepare, and Analyse NOAA OISST Data: Alternative Methods • heatwaveR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Download, Prepare, and Analyse NOAA OISST Data: Alternative Methods">
<meta property="og:description" content="This vignette demonstrates an alternative method for downloading NOAA OISST data (using a python script) and preparing and detecting marine heatwaves.">
<meta property="og:image" content="https://robwschlegel.github.io/heatwaveR/index.html/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-118123016-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118123016-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">heatwaveR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/detection_and_visualisation.html">Basic Detection and Visualisation of Events</a>
    </li>
    <li>
      <a href="../articles/event_categories.html">Calculating and Visualising Event Categories</a>
    </li>
    <li>
      <a href="../articles/exceedance.html">Calculating and Visualising Exceedances</a>
    </li>
    <li>
      <a href="../articles/complex_clims.html">Alternative Thresholds</a>
    </li>
    <li>
      <a href="../articles/MHW_metric_trends.html">Trend and Breakpoint Analyses</a>
    </li>
    <li>
      <a href="../articles/OISST_preparation.html">Downloading and Preparing OISST Data</a>
    </li>
    <li>
      <a href="../articles/gridded_event_detection.html">Detecting Events in Gridded Data</a>
    </li>
    <li>
      <a href="../articles/Download_SST_v2.html">Download, Prepare, and Analyse Data: Alternative</a>
    </li>
    <li>
      <a href="../articles/MHW_to_nc.html">Saving MHW Results to NetCDF</a>
    </li>
  </ul>
</li>
<li>
  <a href="../CITATIONS.html">Citations</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/robwschlegel/heatwaveR" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Download, Prepare, and Analyse NOAA OISST Data:
Alternative Methods</h1>
                        <h4 data-toc-skip class="author">AJ Smit</h4>
            
            <h4 data-toc-skip class="date">2023-03-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/robwschlegel/heatwaveR/blob/HEAD/vignettes/Download_SST_v2.Rmd" class="external-link"><code>vignettes/Download_SST_v2.Rmd</code></a></small>
      <div class="hidden name"><code>Download_SST_v2.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In this vignette we shall look at retrieving and processing the <a href="https://journals.ametsoc.org/doi/full/10.1175/2007JCLI1824.1" class="external-link">Reynolds
Optimally Interpolated Sea Surface Temperature</a> (OISST), which is a
global data set of Advanced Very High Resolution Radiometer (AVHRR)
derived SSTs at a daily resolution, starting on 1 September 1981. The
source of the data is the <a href="https://podaac.jpl.nasa.gov/" class="external-link">Physical Oceanography Distributed
Active Archive Centre (PODAAC)</a>.</p>
<p>Several steps are involved:</p>
<ul>
<li>Retrieving the data using a python script</li>
<li>Using CDO to combine the daily files into an über netCDF</li>
<li>Extracting the giant netCDF using <code>tidync</code>
</li>
<li>Creating longitude slices</li>
<li>Detecting MHWs in each slice in parallel</li>
</ul>
<div class="figure">
<img src="https://i.imgur.com/8idteKC.png" style="width:100.0%" alt=""><p class="caption"><strong>Figure 1.</strong> OISST data plotted on a
Gnomonic Cubed Sphere projection thanks to <a href="https://www.giss.nasa.gov/tools/panoply/" class="external-link">Panoply</a>—the
similarity with certain religious iconography is purely
coincidental.</p>
</div>
<p>Each global, daily file is around 8.3Mb, so they add up to a large
amount of data when a time series of at least 30 years duration is
downloaded. A time series of at least 30 years is needed for heatwave
detection. Currently I have 13,216 of these global files, and this
amounts to ~108Gb of total disk space. Since not everyone will need all
of these data, we shall subset the data using a python script prior to
downloading them.</p>
</div>
<div class="section level2">
<h2 id="subsetting-using-a-python-script">Subsetting using a python script<a class="anchor" aria-label="anchor" href="#subsetting-using-a-python-script"></a>
</h2>
<p>To do the subsetting and bring the data to your local
computer/server, you will need access to <strong>python 2.7</strong>
with <strong>numpy</strong>. Make sure it is installed on your system
and visible on the system PATH.</p>
<p>Create a folder on your server where all the data will be received,
below, for example, I use
<code>/Users/ajsmit/spatial/test/netCDF</code>.</p>
<p>Into this directory, copy the python script,
<code>subset_dataset.py</code> (<a href="https://podaac.jpl.nasa.gov/forum/viewtopic.php?f=5&amp;t=219" class="external-link">link</a>).
Remember to make the file executable by running
<code>chmod +x subset_dataset.py</code>. I use MacOS X (or linux), so
I’m not able to provide instructions if you use Windows. In a terminal,
change to the directory that will receive the netCDF files, where the
python script now lives. If python is in your system’s path, you should
be able to execute the following command on the terminal/command line at
the prompt <code>&gt;</code>:</p>
<p><code>&gt; ./subset_dataset.py -s 19810901 -f 20171014 -b 5 45 -50 -12 -x AVHRR_OI-NCEI-L4-GLOB-v2.0</code></p>
<p>Encapsulated by the above command are the following parameters:</p>
<ul>
<li>long.min = 5</li>
<li>long.max = 45</li>
<li>lat.min = -50</li>
<li>lat.max = -12</li>
<li>start.date = 1981-09-01 (the OISST dataset starts here)</li>
<li>end.date = 2022-02-28 (daily, new data are made available)</li>
<li>short.name = AVHRR_OI-NCEI-L4-GLOB-v2.0</li>
</ul>
<p>The spatial extent is for a region around southern Africa that has
both the Benguela and Agulhas Current in it; we select files starting in
1981-09-01 and going up to 2022-02-28. The short name is the name
mentioned on the <a href="https://podaac.jpl.nasa.gov/dataset/AVHRR_OI-NCEI-L4-GLOB-v2.0" class="external-link">Reynolds
OISST data website</a>—substituting this name for any of the other SST
datasets on that website <em>should</em> then permit the retrieval of
other data sets (e.g. the <a href="https://podaac.jpl.nasa.gov/dataset/MUR-JPL-L4-GLOB-v4.1" class="external-link">MUR
data’s</a> short name is MUR-JPL-L4-GLOB-v4.1). This website seems to be
down frequently, so try a couple of times if it does not work the first
time.</p>
<p>Adjust any of these parameters to taste in order to define the
spatial extent and the time period as required by your study.</p>
<p>If everything works according to plan, a bunch of data will now be
downloaded. This might take several hours. There will be one netCDF file
for each day of the study period. In later steps we shall combine them
into one netCDF file, and then do some further processing to extract the
marine heatwaves.</p>
</div>
<div class="section level2">
<h2 id="combine-daily-netcdfs-into-an-über-netcdf-using-cdo">Combine daily netCDFs into an über netCDF using CDO<a class="anchor" aria-label="anchor" href="#combine-daily-netcdfs-into-an-%C3%BCber-netcdf-using-cdo"></a>
</h2>
<p>The approach taken here sequentially slices the combined über netCDF
and then detects marine heatwaves in parallel within each ‘slice.’</p>
<p>To make a giant netCDF, I use the <a href="https://code.mpimet.mpg.de/projects/cdo" class="external-link">Climate Data
Operators</a> (CDO) command in the terminal:</p>
<p><code>&gt; cdo mergetime *.nc OISST_combined.nc</code></p>
<p>This can easily be applied to global data from 1 Sept 1981 to
present. One can make a function in R to call <code>cdo</code> so as to
do everything within an R script. Each new daily file can then be added
to the über netCDF as it becomes available.</p>
<p>An advantage of working with this big netCDF is that subsetting and
slicing are much easier and faster compared to working with individual
files per each longitude slice.</p>
<p>Another advantage of going the combined netCDF route is that the
resultant giant file is much smaller than either a db file or a series
of RData files (e.g. one file per longitude slice). This is because
netCDF has obvious advantages when it comes to storing array data,
e.g. ~10 years worth of daily global files result in these file
sizes:</p>
<ul>
<li>netCDF: 30 Gb, or</li>
<li>csv and db file: ~97 Gb each</li>
</ul>
</div>
<div class="section level2">
<h2 id="extract-sst-data-using-tidync-and-parallel-process-individual-slices">Extract SST data using <code>tidync</code>, and parallel process
individual ‘slices’<a class="anchor" aria-label="anchor" href="#extract-sst-data-using-tidync-and-parallel-process-individual-slices"></a>
</h2>
<p>I use <code><a href="https://docs.ropensci.org/tidync/reference/tidync.html" class="external-link">tidync::tidync()</a></code> to sequentially select small
slices that fit into memory and process each in parallel using
<code>plyr::ldapply()</code>. Someday I’ll replace the <code>plyr</code>
function with something newer as this package is sadly no longer
maintained. Maybe one of the <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> family of functions in
the <strong>purrr</strong> package? The ‘width’ of a slice can be scaled
with the amount of memory, and the subsequent parallel processing to
detect the events within each slice scales with the number of CPU
cores.</p>
</div>
<div class="section level2">
<h2 id="apply-the-slice-and-detect-functions">Apply the slice and detect functions<a class="anchor" aria-label="anchor" href="#apply-the-slice-and-detect-functions"></a>
</h2>
<p>Here is a set of steps that does the job for me:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages -----------------------------------------------------------</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/tidync/" class="external-link">tidync</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span> <span class="co"># for the fast fwrite() function</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://robwschlegel.github.io/heatwaveR/index.html">heatwaveR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span>cores <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="co"># not using all 16</span></span>
<span></span>
<span><span class="co"># Define paths ------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">datadir</span> <span class="op">&lt;-</span> <span class="st">"/Volumes/OceanData"</span></span>
<span><span class="va">oisst_file_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">datadir</span>, <span class="st">"/test_files"</span><span class="op">)</span></span>
<span><span class="va">nc_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">oisst_file_dir</span>, <span class="st">"/OISST_combined.nc"</span><span class="op">)</span></span>
<span><span class="va">MHW_dir</span> <span class="op">&lt;-</span> <span class="va">datadir</span></span>
<span></span>
<span><span class="co"># Define various functions ------------------------------------------------</span></span>
<span></span>
<span><span class="co"># A load and slice function for the combined netCDF</span></span>
<span><span class="va">OISST_load</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file_name</span>, <span class="va">lon1</span>, <span class="va">lon2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">OISST_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/tidync/reference/tidync.html" class="external-link">tidync</a></span><span class="op">(</span><span class="va">file_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://docs.ropensci.org/tidync/reference/hyper_filter.html" class="external-link">hyper_filter</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lon1</span>, <span class="va">lon2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://docs.ropensci.org/tidync/reference/hyper_tibble.html" class="external-link">hyper_tibble</a></span><span class="op">(</span>select_var <span class="op">=</span> <span class="st">"sst"</span>, force <span class="op">=</span> <span class="cn">TRUE</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">zlev</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">time</span>, temp <span class="op">=</span> <span class="va">sst</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">t</span>, origin <span class="op">=</span> <span class="st">"1978-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">OISST_dat</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">OISST_dat</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Rob's MHW detect function</span></span>
<span><span class="va">event_only</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># first calculate the climatologies</span></span>
<span>  <span class="va">clim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ts2clm.html">ts2clm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, climatologyPeriod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1991-01-01"</span>, <span class="st">"2020-12-31"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># then the events</span></span>
<span>  <span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect_event.html">detect_event</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">clim</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">clim</span><span class="op">)</span></span>
<span>  <span class="co"># return only the event metric dataframe of results</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">event</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">event</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Execute the code --------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># Define the slices</span></span>
<span><span class="co"># 10° longitude slices seem to work fine on</span></span>
<span><span class="co"># my MacBook Pro with 64Gb RAM and 16 cores</span></span>
<span><span class="va">slice_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>lon1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">350</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                   lon2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">360</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="co"># extract slices sequentially</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">slice_df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/noquote.html" class="external-link">noquote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Processing slice"</span>, <span class="va">i</span>, <span class="st">"of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">slice_df</span><span class="op">)</span>,</span>
<span>                      <span class="st">"--&gt;"</span>, <span class="va">slice_df</span><span class="op">$</span><span class="va">lon1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"to"</span>, <span class="va">slice_df</span><span class="op">$</span><span class="va">lon2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"°E\n"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/noquote.html" class="external-link">noquote</a></span><span class="op">(</span><span class="st">"  &gt; 1. loading and slicing NetCDF\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">sst</span> <span class="op">&lt;-</span> <span class="fu">OISST_load</span><span class="op">(</span><span class="va">nc_file</span>, lon1 <span class="op">=</span> <span class="va">slice_df</span><span class="op">$</span><span class="va">lon1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, lon2 <span class="op">=</span> <span class="va">slice_df</span><span class="op">$</span><span class="va">lon2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="co"># process each slice in parallel</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/noquote.html" class="external-link">noquote</a></span><span class="op">(</span><span class="st">"  &gt; 2. detecting marine heatwaves\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">MHW</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ddply.html" class="external-link">ddply</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">sst</span>, .variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>,</span>
<span>                       .fun <span class="op">=</span> <span class="va">event_only</span>, .parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">sst</span><span class="op">)</span></span>
<span>    <span class="co"># save results to disk</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/noquote.html" class="external-link">noquote</a></span><span class="op">(</span><span class="st">"  &gt; 3. saving events to csv\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">MHW</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">datadir</span>, <span class="st">"/MHW_slice_"</span>, <span class="va">i</span>, <span class="st">"_"</span>,</span>
<span>                              <span class="va">slice_df</span><span class="op">$</span><span class="va">lon1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"-"</span>, <span class="va">slice_df</span><span class="op">$</span><span class="va">lon2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">MHW</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/noquote.html" class="external-link">noquote</a></span><span class="op">(</span><span class="st">"SLICE DONE!\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span>sep<span class="op">=</span><span class="st">"\n\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Please let me know if there are issues with the scripts, or if you
have suggesations about how to improve them.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robert W. Schlegel, Albertus J. Smit.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '2edc7627dae0471f3d765c3355bebbf3',
    indexName: 'heatwaver',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
