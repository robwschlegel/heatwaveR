<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Detect consecutive days in exceedance above or below of a given threshold. — exceedance • heatwaveR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Detect consecutive days in exceedance above or below of a given threshold. — exceedance"><meta name="description" content="Detect consecutive days in exceedance above or below of a given threshold."><meta property="og:description" content="Detect consecutive days in exceedance above or below of a given threshold."><meta property="og:image" content="https://robwschlegel.github.io/heatwaveR/index.html/logo.png"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-118123016-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118123016-1');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">heatwaveR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.3.9003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/detection_and_visualisation.html">Basic Detection and Visualisation of Events</a></li>
    <li><a class="dropdown-item" href="../articles/event_categories.html">Calculating and Visualising Event Categories</a></li>
    <li><a class="dropdown-item" href="../articles/exceedance.html">Calculating and Visualising Exceedances</a></li>
    <li><a class="dropdown-item" href="../articles/complex_clims.html">Alternative Thresholds</a></li>
    <li><a class="dropdown-item" href="../articles/MHW_metric_trends.html">Trend and Breakpoint Analyses</a></li>
    <li><a class="dropdown-item" href="../articles/OISST_preparation.html">Downloading and Preparing OISST Data</a></li>
    <li><a class="dropdown-item" href="../articles/gridded_event_detection.html">Detecting Events in Gridded Data</a></li>
    <li><a class="dropdown-item" href="../articles/Download_SST_v2.html">Download, Prepare, and Analyse Data: Alternative</a></li>
    <li><a class="dropdown-item" href="../articles/MHW_to_nc.html">Saving MHW Results to NetCDF</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="http://choc.imev-mer.fr/shiny/demoMHW/">Tutorial</a></li>
<li class="nav-item"><a class="nav-link" href="../CITATIONS.html">Citations</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/robwschlegel/heatwaveR"><span class="fa fa-github fa-lg"></span> github</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Detect consecutive days in exceedance above or below of a given threshold.</h1>
      <small class="dont-index">Source: <a href="https://github.com/robwschlegel/heatwaveR/blob/HEAD/R/exceedance.R" class="external-link"><code>R/exceedance.R</code></a></small>
      <div class="d-none name"><code>exceedance.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Detect consecutive days in exceedance above or below of a given threshold.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">exceedance</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  x <span class="op">=</span> <span class="va">t</span>,</span>
<span>  y <span class="op">=</span> <span class="va">temp</span>,</span>
<span>  <span class="va">threshold</span>,</span>
<span>  below <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  minDuration <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  joinAcrossGaps <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  maxGap <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  maxPadLength <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  roundRes <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  returnDF <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame with at least the two following columns:
a <code>t</code> column which is a vector of dates of class <code>Date</code>,
and a <code>temp</code> column, which is the temperature on those given
dates. If columns are named differently, their names can be supplied as <code>x</code>
and <code>y</code> (see below). The function will not accurately detect consecutive
days of temperatures in exceedance of the <code>threshold</code> if missing days of
data are not filled in with <code>NA</code>. Data of the appropriate format are created
by the internal function <code><a href="make_whole_fast.html">make_whole_fast</a></code>, but your own data may be used
directly if they meet the given criteria. Note that it is also possible to provide hourly
data in the <code>x</code> column as class <code>POSIXct</code>.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>This column is expected to contain a vector of dates as per the
specification of <code>make_whole_fast</code>. If a column headed <code>t</code> is present in
the dataframe, this argument may be omitted; otherwise, specify the name of
the column with dates here. Note that it is also possible to provide hourly
data as class <code>POSIXct</code>.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>This is a column containing the measurement variable. If the column
name differs from the default (i.e. <code>temp</code>), specify the name here.</p></dd>


<dt id="arg-threshold">threshold<a class="anchor" aria-label="anchor" href="#arg-threshold"></a></dt>
<dd><p>The static threshold used to determine how many consecutive
days are in exceedance of the temperature of interest.</p></dd>


<dt id="arg-below">below<a class="anchor" aria-label="anchor" href="#arg-below"></a></dt>
<dd><p>Default is <code>FALSE</code>. When set to TRUE, consecutive days of temperature
below the <code>threshold</code> variable are calculated. When set to FALSE,
consecutive days above the <code>threshold</code> variable are calculated.</p></dd>


<dt id="arg-minduration">minDuration<a class="anchor" aria-label="anchor" href="#arg-minduration"></a></dt>
<dd><p>Minimum duration that temperatures must be in exceedance
of the <code>threshold</code> variable. The default is <code>5</code> days.</p></dd>


<dt id="arg-joinacrossgaps">joinAcrossGaps<a class="anchor" aria-label="anchor" href="#arg-joinacrossgaps"></a></dt>
<dd><p>A TRUE/FALSE statement that indicates whether
or not to join consecutive days of temperatures in exceedance of the
<code>threshold</code> across a small gap between groups before/after a short
gap as specified by <code>maxGap</code>. The default is <code>TRUE</code>.</p></dd>


<dt id="arg-maxgap">maxGap<a class="anchor" aria-label="anchor" href="#arg-maxgap"></a></dt>
<dd><p>The maximum length of the gap across which to connect
consecutive days in exceedance of the <code>threshold</code> when
<code>joinAcrossGaps = TRUE</code>.</p></dd>


<dt id="arg-maxpadlength">maxPadLength<a class="anchor" aria-label="anchor" href="#arg-maxpadlength"></a></dt>
<dd><p>Specifies the maximum length of days over which to
interpolate (pad) missing data (specified as <code>NA</code>) in the input
temperature time series; i.e., any consecutive blocks of NAs with length
greater than <code>maxPadLength</code> will be left as <code>NA</code>. Set as an
integer. The default is <code>3</code> days. Note this will be units of hours if
hourly data were provided.</p></dd>


<dt id="arg-roundres">roundRes<a class="anchor" aria-label="anchor" href="#arg-roundres"></a></dt>
<dd><p>This argument allows the user to choose how many decimal places
the exceedance metric outputs will be rounded to. Default is 4. To
prevent rounding set <code>roundRes = FALSE</code>. This argument may only be given
numeric values or FALSE.</p></dd>


<dt id="arg-returndf">returnDF<a class="anchor" aria-label="anchor" href="#arg-returndf"></a></dt>
<dd><p>The default (<code>TRUE</code>) tells the function to return the results as
type <code>data.frame</code>. <code>FALSE</code> will return the results as a <code>data.table</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function will return a list of two data.frames.
The first being <code>threshold</code>, which shows the daily temperatures and on which
specific days the given <code>threshold</code> was exceeded. The second component of the
list is <code>exceedance</code>, which shows a medley of statistics for each discrete
group of days in exceedance of the given <code>threshold</code>. Note that any additional
columns left in the data frame given to this function will be output in the
<code>threshold</code> component of the output. For example, if one uses
<code><a href="ts2clm.html">ts2clm</a></code> to prepare a time series for analysis and leaves
in the <code>doy</code> column, this column will appear in the output.</p>
<p>The information shown in the <code>threshold</code> component is:</p>
<dl><dt>t</dt>
<dd><p>The date of the temperature measurement. This variable may named
  differently if an alternative name is supplied to the function's <code>x</code>
  argument.</p></dd>

  <dt>temp</dt>
<dd><p>Temperature on the specified date [deg. C]. This variable may
  named differently if an alternative name is supplied to the function's <code>y</code>
  argument.</p></dd>

  <dt>thresh</dt>
<dd><p>The static <code>threshold</code> chosen by the user [deg. C].</p></dd>

  <dt>thresh_criterion</dt>
<dd><p>Boolean indicating if <code>temp</code> exceeds
  <code>threshold</code>.</p></dd>

  <dt>duration_criterion</dt>
<dd><p>Boolean indicating whether periods of consecutive
  <code>thresh_criterion</code> are &gt;= <code>minDuration</code>.</p></dd>

  <dt>exceedance</dt>
<dd><p>Boolean indicting if all criteria that define a discrete
  group in exceedance of the <code>threshold</code> are met.</p></dd>

  <dt>exceedance_no</dt>
<dd><p>A sequential number indicating the ID and order of
  occurrence of exceedances.</p></dd>


</dl><p>The individual exceedances are summarised using the following metrics:</p>
<dl><dt>exceedance_no</dt>
<dd><p>The same sequential number indicating the ID and
  order of the exceedance as found in the <code>threshold</code> component of the
  output list.</p></dd>

  <dt>index_start</dt>
<dd><p>Row number on which exceedance starts.</p></dd>

  <dt>index_peak</dt>
<dd><p>Row number on which exceedance peaks.</p></dd>

  <dt>index_end</dt>
<dd><p>Row number on which exceedance ends.</p></dd>

  <dt>duration</dt>
<dd><p>Duration of exceedance [days].</p></dd>

  <dt>date_start</dt>
<dd><p>Start date of exceedance [date].</p></dd>

  <dt>date_peak</dt>
<dd><p>Date of exceedance peak [date].</p></dd>

  <dt>date_end</dt>
<dd><p>End date of exceedance [date].</p></dd>

  <dt>intensity_mean</dt>
<dd><p>Mean intensity [deg. C].</p></dd>

  <dt>intensity_max</dt>
<dd><p>Maximum (peak) intensity [deg. C].</p></dd>

  <dt>intensity_var</dt>
<dd><p>Intensity standard deviation [deg. C].</p></dd>

  <dt>intensity_cumulative</dt>
<dd><p>Cumulative intensity [deg. C x days].</p></dd>

  <dt>rate_onset</dt>
<dd><p>Onset rate of exceedance [deg. C / day].</p></dd>

  <dt>rate_decline</dt>
<dd><p>Decline rate of exceedance [deg. C / day].</p></dd>


</dl><p><code>intensity_max_abs</code>, <code>intensity_mean_abs</code>, <code>intensity_var_abs</code>,
and <code>intensity_cum_abs</code> are as above except as absolute magnitudes rather
than relative to the threshold.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<ol><li><p>This function assumes that the input time series consists of continuous
daily temperatures, with few missing values. The accompanying function
<code><a href="make_whole_fast.html">make_whole_fast</a></code> aids in the preparation of a time series that is
suitable for use with <code>exceedance</code>, although this may also be accomplished
'by hand' as long as the criteria are met as discussed in the documentation
to <code><a href="make_whole_fast.html">make_whole_fast</a></code>.</p></li>
<li><p>Future versions seek to accommodate monthly and annual time series, too.</p></li>
<li><p>The calculation of onset and decline rates assumes that exceedance of the
<code>threshold</code> started a half-day before the start day and ended a half-day
after the end-day. This is consistent with the duration definition as implemented,
which assumes duration = end day - start day + 1.</p></li>
<li><p>For the purposes of exceedance detection, any missing temperature values not
interpolated over (through optional <code>maxPadLength</code>) will remain as
<code>NA</code>. This means they will trigger the end of an exceedance if the adjacent
temperature values are in exceedance of the <code>threshold</code>.</p></li>
<li><p>If the function is used to detect consecutive days of temperature under
the given <code>theshold</code>, these temperatures are then taken as being in
exceedance below the <code>threshold</code> as there is no antonym in the English
language for 'exceedance'.</p></li>
</ol><p>This function is based largely on the <code>detect_event</code> function found in this
package, which was ported from the Python algorithm that was written by Eric
Oliver, Institute for Marine and Antarctic Studies, University of Tasmania,
Feb 2015, and is documented by Hobday et al. (2016).</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Robert W. Schlegel, Albertus J. Smit</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">exceedance</span><span class="op">(</span><span class="va">sst_WA</span>, threshold <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># show first ten days of daily data:</span></span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">threshold</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             t  temp thresh threshCriterion durationCriterion exceedance</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  1982-01-01 20.94     25           FALSE             FALSE      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  1982-01-02 21.25     25           FALSE             FALSE      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  1982-01-03 21.38     25           FALSE             FALSE      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  1982-01-04 21.16     25           FALSE             FALSE      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  1982-01-05 21.26     25           FALSE             FALSE      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  1982-01-06 21.61     25           FALSE             FALSE      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  1982-01-07 21.74     25           FALSE             FALSE      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  1982-01-08 21.50     25           FALSE             FALSE      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  1982-01-09 21.40     25           FALSE             FALSE      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 1982-01-10 21.36     25           FALSE             FALSE      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    exceedance_no</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1             NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2             NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3             NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4             NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5             NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6             NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7             NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8             NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9             NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10            NA</span>
<span class="r-in"><span><span class="co"># show first five exceedances:</span></span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">exceedance</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   exceedance_no index_start index_peak index_end duration date_start  date_peak</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1             1        2682       2683      2686        5 1989-05-05 1989-05-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2             2        6342       6351      6358       17 1999-05-13 1999-05-22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3             3        6362       6363      6368        7 1999-06-02 1999-06-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4             4        6686       6688      6691        6 2000-04-21 2000-04-23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5             5        6698       6699      6707       10 2000-05-03 2000-05-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     date_end intensity_mean intensity_max intensity_var intensity_cumulative</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 1989-05-09         0.2860          0.36        0.0462                 1.43</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 1999-05-29         0.8559          1.40        0.3859                14.55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 1999-06-08         0.2071          0.27        0.0512                 1.45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 2000-04-26         0.1550          0.41        0.1803                 0.93</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 2000-05-12         0.6970          1.01        0.2747                 6.97</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   intensity_mean_abs intensity_max_abs intensity_var_abs intensity_cum_abs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            25.2860             25.36            0.0462            126.43</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            25.8559             26.40            0.3859            439.55</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            25.2071             25.27            0.0512            176.45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            25.1550             25.41            0.1803            150.93</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            25.6970             26.01            0.2747            256.97</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   rate_onset rate_decline</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     0.1900       0.1171</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     0.1826       0.1787</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     0.1400       0.0555</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     0.2540       0.1214</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     0.5600       0.1371</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert W. Schlegel, Albertus J. Smit.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

